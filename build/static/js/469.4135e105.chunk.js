"use strict";(self.webpackChunkbestune_admin=self.webpackChunkbestune_admin||[]).push([[469],{3613:(e,t,n)=>{n.d(t,{A:()=>s});var i,a=n(57528),o=n(29769);const r=(0,n(66253).default)(o.dS)(i||(i=(0,a.A)(["\n  display: flex;\n  flex-direction: column-reverse;\n  border: none;\n  width: 100%;\n  padding-bottom: 20px;\n  .quill {\n    .ql-container {\n      .ql-tooltip {\n        transform: translateX(97px);\n        z-index: 10;\n      }\n      .ql-editor {\n        background-color: #fff;\n        padding: 15px;\n        border-radius: 12px;\n        min-height: 80px;\n        transition: all 0.3s;\n        border: 1px solid #d9d9d9;\n        p {\n          margin: 0;\n          font-size: 14px;\n        }\n      }\n    }\n  }\n  .ql-toolbar {\n    padding: 0;\n    transition: opacity 1s ease-out;\n    border-radius: 0;\n    border-bottom: none;\n    margin-top: 10px;\n    button {\n      border: none;\n      margin: 0 5px;\n      svg {\n        width: 24px !important;\n        height: 24px !important;\n        fill: #000 !important;\n        path {\n          fill: #000;\n        }\n      }\n    }\n  }\n  .ql-editing {\n    left: 30px !important;\n    transform: translateX(0px) !important;\n    z-index: 100;\n  }\n"])));var l=n(70579);const s=e=>{const{value:t,onChange:n,onImageUpload:i,isError:a,type:o}=e;return(0,l.jsx)(r,{controls:[["bold","italic","underline","strike","clean","unorderedList","orderedList","alignLeft","alignCenter","alignRight"]],isError:!!a,value:t,onChange:n,onImageUpload:i,type:o})}},6790:(e,t,n)=>{n.d(t,{J1:()=>i,br:()=>o,eM:()=>a,lq:()=>r});const i=[{_id:"cash",name:"Naqd",trans_key:"cash"}],a=[{_id:"percent",name:"Foiz",trans_key:"percent"},{_id:"amount",name:"Miqdor",trans_key:"amount"}],o=[{name:"functionality",key:"functionality",role:"role"},{name:"discounts",key:"discountOrder",role:"role"},{name:"bonus",key:"bonusOrder",role:"role"},{name:"premium_discounts",key:"premiumDiscountOrder",role:"role"},{name:"main_address",key:"mainAddress",role:"role"},{name:"website_conditions",key:"websiteConditions",role:"role"}],r=[{rate:5},{rate:4},{rate:3},{rate:2},{rate:1}]},31469:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ee});var i=n(5468),a=n(49752),o=n(53536),r=n(74117),l=n(72824),s=n(70579);var d,c,u=n(83501),m=n(72473),p=n(13094),g=n(68903),x=n(72221),h=n(32143),y=n(65043),b=n(24858),v=n(89379),j=n(96446),f=n(19042),A=n(61698),I=n(57528),k=n(66253);const w=k.default.div(d||(d=(0,I.A)(["\n  .product-images {\n    display: flex;\n    flex-wrap: wrap;\n    .input-file {\n      margin-right: 10px;\n    }\n    .product-image {\n      position: relative;\n      width: 76px;\n      height: 76px;\n      border-radius: 12px;\n      overflow: hidden;\n      margin-right: 10px;\n      margin-bottom: 10px;\n      cursor: pointer;\n      &:hover {\n        .on-hover {\n          display: flex;\n        }\n      }\n      img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n      .on-hover {\n        position: absolute;\n        left: 0;\n        right: 0;\n        top: 0;\n        bottom: 0;\n        display: none;\n        align-items: center;\n        justify-content: center;\n        background-color: rgba(0, 0, 0, 0.5);\n        .delete svg {\n          width: 20px;\n          height: 20px;\n          path {\n            fill: #fff;\n          }\n        }\n        .main-image {\n          position: absolute;\n          right: 5px;\n          top: 5px;\n          width: 15px;\n          height: 15px;\n          border-radius: 50%;\n          border: 2px solid gold;\n          &.active {\n            background-color: gold;\n          }\n        }\n      }\n    }\n  }\n"]))),S=k.default.div(c||(c=(0,I.A)(["\n  h2 {\n    color: black;\n  }\n  h4 {\n    color: black;\n  }\n  .import-student-box {\n    width: 100%;\n\n    label {\n      width: max-content;\n      min-height: max-content !important;\n      display: flex;\n      align-items: center;\n      gap: 20px;\n      border-radius: 10px;\n      transition: all 0.3s ease;\n      margin: 0 auto;\n      padding: 12px;\n      color: black;\n\n      .upload-input {\n        position: absolute !important;\n        top: 0 !important;\n        left: 0 !important;\n        opacity: 0 !important;\n        z-index: -1 !important;\n      }\n\n      &:hover {\n        background-color: gray;\n      }\n    }\n  }\n  .errors-upload {\n    margin-bottom: 12px;\n    .content {\n      width: 100%;\n      padding: 10px;\n      background-color: gray;\n      border-radius: 6px;\n      max-height: 400px;\n      overflow: auto;\n    }\n  }\n"])));var C=n(3613),_=n(58885),E=n(6790),N=n(99866),z=n(51387),q=n(47260);const D=e=>{let{attributeId:t,control:n,register:a,getByIdData:o}=e;const{fields:l,append:d,remove:c}=(0,b.jz)({control:n,name:"attributes.".concat(t)}),{t:u}=(0,r.Bd)();return(0,s.jsxs)("div",{children:[null===l||void 0===l?void 0:l.map((e,o)=>(0,s.jsxs)(g.Ay,{container:!0,className:"flex items-end justify-between mt-2",children:[(0,s.jsx)(g.Ay,{item:!0,md:5,children:(0,s.jsx)(i.ks,{control:n,name:"attributes.".concat(t,".").concat(o,".attributeItem"),type:"text",rules:{required:!1},label:u("general.feature")})}),(0,s.jsx)(g.Ay,{item:!0,md:5,children:(0,s.jsx)(i.pd,{label:u("general.Price_added"),params:(0,v.A)({type:"number"},a("attributes.".concat(t,".").concat(o,".amount")))})}),(0,s.jsx)(g.Ay,{item:!0,md:1,children:(0,s.jsx)(z.A,{sx:{cursor:"pointer",color:"#D54239",fontSize:"1.5rem"},className:"mb-2.5",onClick:()=>(e=>{c(e)})(o)})})]},e.id)),(0,s.jsx)(g.Ay,{item:!0,xs:3,md:2,paddingBlock:2,className:"flex flex-col",children:(0,s.jsx)(N.A,{startIcon:(0,s.jsx)(_.c1,{}),type:"button",onClick:()=>{d({amount:0,attributeItem:""})}})})]})};var F;const L=k.default.div(F||(F=(0,I.A)(['\n  h3 {\n    font-size: 14px;\n    font-weight: 500;\n    color: #32324d;\n    margin-bottom: 8px;\n  }\n  .just-image,\n  .pre-loader {\n    width: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    img {\n      object-fit: contain !important;\n    }\n  }\n  .input-file {\n    position: relative;\n    display: inline-block;\n    cursor: pointer;\n    .image-main {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      width: 76px;\n      height: 76px;\n      border-radius: 12px;\n      background: #f3f3f8;\n    }\n  }\n  .input-file input[type="file"] {\n    position: absolute;\n    z-index: -1;\n    opacity: 0;\n    display: block;\n    width: 0;\n    height: 0;\n  }\n\n  /* Focus */\n  .input-file input[type="file"]:focus + span {\n    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);\n  }\n\n  .input-file:active span {\n    background-color: #2e703a;\n  }\n\n  /* Disabled */\n  .input-file input[type="file"]:disabled + span {\n    background-color: #eee;\n  }\n\n  /* \u0421\u043f\u0438\u0441\u043e\u043a c \u043f\u0440\u0435\u0432\u044c\u044e */\n  .input-file-list {\n    padding: 10px 0;\n  }\n  .input-file-list-item {\n    display: inline-block;\n    margin: 0 15px 15px;\n    width: 150px;\n    vertical-align: top;\n    position: relative;\n  }\n  .input-file-list-item img {\n    width: 150px;\n  }\n  .input-file-list-name {\n    text-align: center;\n    display: block;\n    font-size: 12px;\n    text-overflow: ellipsis;\n    overflow: hidden;\n  }\n  .input-file-list-remove {\n    color: #fff;\n    text-decoration: none;\n    display: inline-block;\n    position: absolute;\n    padding: 0;\n    margin: 0;\n    top: 5px;\n    right: 5px;\n    background: #ff0202;\n    width: 16px;\n    height: 16px;\n    text-align: center;\n    line-height: 16px;\n    border-radius: 50%;\n  }\n'])));var M=n(81637),O=n(56403),T=n(47503);const P=e=>{const[t,n]=(0,y.useState)(),[i,a]=(0,y.useState)();return{imageFile:t,isUploading:i,uploadImage:t=>{a(!0),t.imageFile?(0,O.A)({url:"".concat("http://46.101.209.158:3003/v1","/image/product/upload"),method:"POST",headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(localStorage.getItem("token")),"Accept-Language":localStorage.getItem("i18nextLng")},data:{file:t.imageFile,type:"img"}}).then(t=>{const i={url:t.data.data.url,_id:t.data.data._id};null===e||void 0===e||e(i),n(i),a(!1)}).catch(e=>{console.log(e.response.data.message),a(!1),T.oR.error(e.response.data.message,{position:"top-center",autoClose:5e3})}):(a(!1),T.oR.error("Rasm fayl tanlanmadi!",{position:"top-center",autoClose:3e3}))},setImage:n}};const B=function(e){let{title:t,control:n,name:a,setValue:o,rules:r={required:{value:!0,message:"Rasm yuklash majburiy"}},className:l,getImage:d,multiple:c,accept:u="image/*, image/webp"}=e;const p=(0,m.G)(e=>e.formDrawerState.isOpen);(0,y.useEffect)(()=>{p||o(a,void 0)},[p]);const{uploadImage:g,imageFile:x,isUploading:h}=P(e=>{o(a,e),d&&d(e)});return(0,s.jsx)(b.xI,{name:a,control:n,rules:r,render:e=>{var n;let{fieldState:o,field:r}=e;return(0,s.jsxs)(L,{className:l,children:[t&&(0,s.jsx)("h3",{children:t}),(0,s.jsxs)("label",{className:"input-file",children:[(0,s.jsx)("input",{ref:r.ref,id:a,name:r.name,onChange:e=>{var t;null!==(t=e.target.files)&&void 0!==t&&t[0]&&g({imageFile:e.target.files[0],id:a})},type:"file",accept:u}),(0,s.jsx)("div",{className:"image-main",children:h?(0,s.jsx)("div",{className:"pre-loader",children:(0,s.jsx)(M.A,{color:"primary",size:30})}):null!==r&&void 0!==r&&r.value?(0,s.jsx)(i._V,{src:"string"===typeof r.value?r.value:r.value.url||""}):(0,s.jsx)("div",{className:"image-top",children:(0,s.jsx)(_.zG,{})})})]}),o.error&&!x&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("h6",{className:"text-error mt-1",children:null===(n=o.error)||void 0===n?void 0:n.message})})]})}})},R=e=>{var t,n;let{formStore:a,resetForm:o,editingProductId:l,productProps:d}=e;const{productImages:c,setProductImages:u,mainImageId:m,setMainImageId:p}=d,{t:x}=(0,r.Bd)(),{control:h,handleSubmit:I,reset:k,setValue:S,register:F,watch:L,formState:{errors:M}}=a,O=localStorage.getItem("i18nextLng")||"uz",[T,P]=(0,y.useState)(!1),[R,U]=(0,y.useState)(!1),[V,Q]=(0,y.useState)(null),[W,X]=(0,y.useState)(null),[G,J]=(0,y.useState)(null),[K,H]=(0,y.useState)(null),Y=new Date(L("discountStartAt"));Y.setDate(Y.getDate()+1);const{mutate:Z,status:$}=(0,A.L2)(l?"/product/update":"product/create",l?"put":"post"),{data:ee,status:te}=(0,A.gf)("product/get-by-id/".concat(l),{},{enabled:!!l,suspense:!1});(0,y.useEffect)(()=>{L("discountEnabled")||(S("discountType",void 0),S("discountValue",void 0),S("discountStartAt",""),S("discountEndAt",void 0))},[L("discountEnabled")]),(0,y.useEffect)(()=>{const e=L("attributeId")||[],t=L("attributes")||{},n=Object.entries(t).filter(t=>{let[n]=t;return e.includes(n)}).reduce((e,t)=>{let[n,i]=t;return(0,v.A)((0,v.A)({},e),{},{[n]:i})},{});S("attributes",n)},[L("attributeId")]),(0,y.useEffect)(()=>{"success"===$&&o()},[$]),(0,y.useEffect)(()=>{var e,t;null!==ee&&void 0!==ee&&ee.data&&(Q(ee.data.parentCategoryId||null),X(ee.data.categoryId||null),P(!(null===(e=ee.data.attributes)||void 0===e||!e.length)),U(!(null===(t=ee.data.compounds)||void 0===t||!t.length)))},[ee]);(0,y.useEffect)(()=>{if("success"===te){var e,t,n,i,o,r,l,s,d;const m=ee.data;m.parentCategoryId&&J({_id:m.parentCategoryId}),m.categoryId&&H({_id:m.categoryId}),k((0,v.A)((0,v.A)({},ee.data),{},{attributes:(null===(e=ee.data.attributes)||void 0===e?void 0:e.reduce((e,t)=>(0,v.A)((0,v.A)({},e),{},{[t.attribute._id]:t.items}),{}))||[],parentCategoryId:m.parentCategoryId||m.categoryId||"",categoryId:m.categoryId||"",isActiveQuery:a.watch("isActiveQuery"),description:ee.data.description,compounds:ee.data.compounds,attributeId:ee.data.attributeDetails.map(e=>e._id)||[]})),S("isMyExpire",!!L("expiryDate")),u((null===(t=ee.data)||void 0===t?void 0:t.images)||[]);var c;if((null===(n=ee.data)||void 0===n||null===(i=n.images)||void 0===i?void 0:i.find(e=>{var t;return(null===e||void 0===e?void 0:e._id)===(null===(t=ee.data.mainImage)||void 0===t?void 0:t._id)}))&&null!==(o=ee.data)&&void 0!==o&&null!==(r=o.images)&&void 0!==r&&r.length)p(null===(c=ee.data.mainImage)||void 0===c?void 0:c._id);else p(null===(l=ee.data)||void 0===l||null===(s=l.images)||void 0===s||null===(d=s[0])||void 0===d?void 0:d._id)}},[te,ee]),(0,y.useEffect)(()=>{const e=c.find(e=>e._id===m);e?p(e._id):c.length&&p(c[0]._id)},[c]);const{fields:ne,append:ie,remove:ae}=(0,b.jz)({name:"compounds",control:h}),oe=L("attributeId")||[],{mutate:re,data:le,status:se}=(0,A.L2)("attribute/choose","post");(0,y.useEffect)(()=>{re({})},[]);const de=null===le||void 0===le||null===(t=le.data)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.filter(e=>null===oe||void 0===oe?void 0:oe.some(t=>t===e._id)),ce=L("isActive"),ue=(L("compounds"),(0,y.useCallback)((e,t)=>{"compounds"===e?(U(t),S("compounds",[])):"attributes"===e&&(P(t),t||(S("attributes",{}),S("attributeId",[]))),S(e,t)},[S]));return(0,s.jsx)(w,{className:"custom-drawer",children:(0,s.jsx)("form",{id:"product",onSubmit:I(e=>{var t,n;console.log(e);const i=Object.entries(e.attributes||{}).filter(t=>{var n;let[i]=t;return null===(n=e.attributeId)||void 0===n?void 0:n.includes(i)}).reduce((e,t)=>{let[n,i]=t;return(0,v.A)((0,v.A)({},e),{},{[n]:i})},{}),a={name:e.name,price:+e.price,inStock:+e.inStock,redLine:+e.redLine||null,yellowLine:+e.yellowLine||null,categoryId:W?e.categoryId:e.parentCategoryId,isActive:e.isActive,imageIds:c.map(e=>e._id),mainImageId:c.length?m||(null===c||void 0===c||null===(t=c[0])||void 0===t?void 0:t._id):null,expiryDate:e.isMyExpire?"string"===typeof e.expiryDate?e.expiryDate:"object"===typeof e.expiryDate?null===(n=e.expiryDate)||void 0===n?void 0:n.toISOString():null:null,_id:l,discountEnabled:e.discountEnabled,description:e.description,compounds:e.compounds||[],attributes:T?Object.entries(i).map(e=>{let[t,n]=e;return{attributeId:t,items:Array.isArray(n)?n.map(e=>({attributeItem:(null===e||void 0===e?void 0:e.attributeItem)||null,amount:Number(null===e||void 0===e?void 0:e.amount)||0})):[]}}):[]};var o,r;e.discountEnabled&&(a.discountType=e.discountType,a.discountValue=e.discountValue,a.discountStartAt="string"===typeof e.discountStartAt?e.discountStartAt:"object"===typeof e.discountStartAt?null===(o=e.discountStartAt)||void 0===o?void 0:o.toISOString():void 0,a.discountEndAt="string"===typeof e.discountEndAt?e.discountEndAt:"object"===typeof e.discountEndAt?null===(r=e.discountEndAt)||void 0===r?void 0:r.toISOString():void 0);e.discountEnabled||(delete a.discountType,delete a.discountValue,delete a.discountStartAt,delete a.discountEndAt),delete a.isMyExpire,Z(a)}),children:(0,s.jsxs)(g.Ay,{container:!0,spacing:2,children:[(0,s.jsx)(g.Ay,{item:!0,md:12,children:(0,s.jsx)(i.ks,{control:h,name:"name.uz",label:x("common.productName")+" (Uz)"})}),(0,s.jsx)(g.Ay,{item:!0,md:12,children:(0,s.jsx)(i.ks,{control:h,name:"name.ru",label:x("common.productName")+" (Ru)"})}),(0,s.jsx)(g.Ay,{item:!0,md:12,children:(0,s.jsx)(i.ks,{control:h,name:"name.en",label:x("common.productName")+" (En)"})}),(0,s.jsx)(g.Ay,{item:!0,md:12,children:(0,s.jsx)(i.ks,{name:"price",control:h,label:x("common.price"),type:"number"})}),(0,s.jsx)(g.Ay,{item:!0,md:12,children:(0,s.jsx)(i.ks,{name:"inStock",control:h,label:x("common.residue"),type:"number"})}),(0,s.jsxs)(g.Ay,{item:!0,md:12,display:"flex",justifyContent:"space-between",children:[(0,s.jsx)(j.A,{children:(0,s.jsx)(i.ks,{name:"redLine",control:h,type:"number",label:x("Qizil chiziq"),rules:{required:!1}})}),(0,s.jsx)(j.A,{children:(0,s.jsx)(i.ks,{name:"yellowLine",control:h,label:x("Sariq chiziq"),type:"number",rules:{required:!1}})})]}),(0,s.jsxs)(g.Ay,{item:!0,md:12,children:[(0,s.jsx)(i.r6,{control:h,name:void 0!==W?"parentCategoryId":"categoryId",optionsUrl:"category/paging",dataProp:"data.data",label:"Kategoriya",onChange:e=>{J(e),H(null),S("categoryId",""),S("parentCategoryId",(null===e||void 0===e?void 0:e._id)||"")}}),G&&(0,s.jsx)(i.r6,{control:h,name:"categoryId",optionsUrl:"category/paging",dataProp:"data.data",label:"Ichki kategoriya",rules:{required:!1},onChange:e=>{H(e),S("categoryId",(null===e||void 0===e?void 0:e._id)||"")},exQueryParams:{parentId:null===G||void 0===G?void 0:G._id}},"child-cat-".concat(null===G||void 0===G?void 0:G._id))]}),(0,s.jsxs)(g.Ay,{item:!0,md:12,children:[(0,s.jsx)("label",{className:"custom-label",children:x("common.description")}),(0,s.jsx)(b.xI,{name:"description",control:h,render:e=>{let{field:t}=e;return(0,s.jsx)(C.A,{value:t.value,onChange:e=>{t.onChange(e)}})}})]}),(0,s.jsx)(g.Ay,{item:!0,md:12,children:(0,s.jsxs)(j.A,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,s.jsx)("label",{htmlFor:"isActive",children:x("common.isActive")}),(0,s.jsx)(f.A,{checked:!!ce,onChange:e=>ue("isActive",e.target.checked),id:"isActive"})]})}),(0,s.jsxs)(g.Ay,{item:!0,md:12,children:[(0,s.jsxs)(j.A,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,s.jsx)("label",{htmlFor:"isMyExpire",children:"Muddatli mahsulot"}),(0,s.jsx)(f.A,(0,v.A)({checked:!!L("isMyExpire"),id:"isMyExpire"},F("isMyExpire")))]}),L("isMyExpire")&&(0,s.jsx)(g.Ay,{container:!0,children:(0,s.jsx)(g.Ay,{item:!0,md:12,children:(0,s.jsx)(i.T9,{control:h,name:"expiryDate",rules:{required:{value:!0,message:"Majburiy"}},disableTime:!0,label:x("common.validatyPariod"),readOnly:!0,minDate:new Date})})})]}),(0,s.jsxs)(g.Ay,{item:!0,md:12,children:[(0,s.jsxs)(j.A,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,s.jsx)("label",{htmlFor:"discountEnabled",children:x("common.discount")}),(0,s.jsx)(f.A,(0,v.A)({checked:!!L("discountEnabled"),id:"discountEnabled"},F("discountEnabled")))]}),L("discountEnabled")&&(0,s.jsxs)(g.Ay,{container:!0,spacing:2,alignItems:"end",children:[(0,s.jsx)(g.Ay,{item:!0,md:6,children:(0,s.jsx)(i.ks,{control:h,name:"discountValue",label:x("common.discountValue"),type:"number",rules:{required:{value:!1,message:"Majburiy"}},inputProps:"percent"===L("discountType")?{max:100}:{max:Number(L("price"))}})}),(0,s.jsx)(g.Ay,{item:!0,md:6,children:(0,s.jsx)(i.RZ,{control:h,name:"discountType",options:E.eM,label:x("common.type"),rules:{required:{value:!1,message:"Majburiy"}}})}),(0,s.jsx)(g.Ay,{item:!0,md:6,children:(0,s.jsx)(i.T9,{control:h,name:"discountStartAt",disableTime:!0,rules:{required:{value:!1,message:"Majburiy"}},label:x("common.discountStartAt"),minDate:new Date,readOnly:!0,maxDate:L("discountEndAt")?new Date(L("discountEndAt")):void 0})}),(0,s.jsx)(g.Ay,{item:!0,md:6,children:(0,s.jsx)(i.T9,{control:h,name:"discountEndAt",rules:{required:{value:!1,message:"Majburiy"}},disableTime:!0,label:x("common.discountEndAt"),readOnly:!0,minDate:Y})})]})]}),(0,s.jsxs)(g.Ay,{item:!0,md:12,children:[(0,s.jsxs)(j.A,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,s.jsx)("label",{htmlFor:"compounds",children:x("general.compounds")}),(0,s.jsx)(f.A,{checked:R,onChange:e=>ue("compounds",e.target.checked),id:"compounds"})]}),R&&ne.map((e,t)=>(0,s.jsxs)(g.Ay,{container:!0,className:"flex items-end justify-between mt-2",children:[(0,s.jsx)(g.Ay,{item:!0,md:5,children:(0,s.jsx)(i.ks,{control:h,name:"compounds.".concat(t,".name"),type:"text",rules:{required:!1},label:x("general.composition")})}),(0,s.jsx)(g.Ay,{item:!0,md:5,children:(0,s.jsx)(i.pd,{label:x("general.quantity"),params:(0,v.A)({},F("compounds.".concat(t,".value")))})}),(0,s.jsx)(g.Ay,{item:!0,md:1,children:(0,s.jsx)(z.A,{sx:{cursor:"pointer",color:"#D54239",fontSize:"1.5rem"},className:"mb-2.5",onClick:()=>{ae(t)}})})]},e.id))]}),R&&(0,s.jsx)(g.Ay,{item:!0,xs:3,md:2,paddingBlock:2,className:"flex flex-col ",children:(0,s.jsx)(N.A,{startIcon:(0,s.jsx)(_.c1,{}),type:"button",onClick:()=>{ie({name:null,value:null})}})}),(0,s.jsx)(g.Ay,{item:!0,md:12,children:(0,s.jsxs)(j.A,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,s.jsx)("label",{htmlFor:"attributes",children:x("general.attributes")}),(0,s.jsx)(f.A,{checked:T,onChange:e=>ue("attributes",e.target.checked),id:"attributes"})]})}),T&&(0,s.jsx)(g.Ay,{item:!0,md:12,children:(0,s.jsx)(i.r6,{control:h,name:"attributeId",optionsUrl:"attribute/choose",dataProp:"data.data",rules:{required:!1},multiple:!0})}),T&&(null===oe||void 0===oe?void 0:oe.map(e=>{var t;return(0,s.jsxs)(g.Ay,{item:!0,md:12,children:[(0,s.jsx)("p",{className:"text-[#EB5B00] font-bold text-xl",children:null===de||void 0===de||null===(t=de.filter(t=>(null===t||void 0===t?void 0:t._id)===e))||void 0===t?void 0:t.map(e=>{var t;return(0,s.jsxs)("div",{children:[null===(t=e.name)||void 0===t?void 0:t[O],":"]},null===e||void 0===e?void 0:e._id)})}),(0,s.jsx)(D,{attributeId:e,getByIdData:ee,control:h,register:F})]},e)})),(0,s.jsxs)(g.Ay,{item:!0,md:12,children:[(0,s.jsx)("label",{className:"py-2",htmlFor:"",children:x("general.recommendation_img")}),(0,s.jsx)("br",{}),(0,s.jsx)("br",{}),(0,s.jsxs)("div",{className:"product-images",children:[(0,s.jsx)(B,{control:h,setValue:S,name:"image",rules:{required:!1},multiple:!0,getImage:e=>{u(t=>[...t,e]),S("image",null)},accept:".png, .jpg, .jpeg"}),null===c||void 0===c?void 0:c.map(e=>(0,s.jsxs)("div",{className:"product-image",children:[(0,s.jsx)("img",{src:"http://46.101.209.158:3003/v1"+e.url,alt:"product"}),(0,s.jsxs)("div",{className:"on-hover flex gap-2",children:[(0,s.jsx)("span",{className:"delete",onClick:()=>u(t=>t.filter(t=>t._id!==e._id)),children:(0,s.jsx)(_.d7,{})}),(0,s.jsx)("span",{className:"preview",onClick:()=>{const t=document.createElement("div");t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0, 0, 0, 0.8)",t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center",t.style.zIndex="2000";const n=document.createElement("img");n.src="http://46.101.209.158:3003/v1"+e.url,n.alt="preview",n.style.maxWidth="90%",n.style.maxHeight="90%",n.style.border="2px solid white",n.style.borderRadius="8px";const i=document.createElement("span");i.innerText="\xd7",i.style.position="absolute",i.style.top="20px",i.style.right="20px",i.style.fontSize="2rem",i.style.color="white",i.style.cursor="pointer",i.onclick=()=>{document.body.removeChild(t)},t.appendChild(n),t.appendChild(i),document.body.appendChild(t)},children:(0,s.jsx)(q.A,{className:"text-white text-lg"})}),(0,s.jsx)("span",{className:"main-image ".concat(e._id===m&&"active"),onClick:()=>p(null===e||void 0===e?void 0:e._id)})]})]},e._id))]})]})]})})})};var U=n(477),V=n(91686),Q=n(57397);const W=e=>{const[t,n]=(0,y.useState)(),[i,a]=(0,y.useState)();return{imageFile:t,isUploading:i,uploadImage:t=>{a(!0),t.imageFile?(0,O.A)({url:"".concat("http://46.101.209.158:3003/v1","/image/file/upload"),method:"POST",headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(localStorage.getItem("token")),"Accept-Language":localStorage.getItem("i18nextLng")},data:{file:t.imageFile,type:"file"}}).then(t=>{const i={url:t.data.data.url,_id:t.data.data._id};null===e||void 0===e||e(i),n(i),a(!1)}).catch(e=>{console.log(e.response.data.message),a(!1),T.oR.error(e.response.data.message,{position:"top-center",autoClose:5e3})}):(a(!1),T.oR.error("Rasm fayl tanlanmadi!",{position:"top-center",autoClose:3e3}))},setImage:n}};var X=n(85865),G=n(79650),J=n(71806),K=n(84882),H=n(28076),Y=n(10039),Z=n(73460);const $=()=>{var e,t;const[n,a]=(0,y.useState)(""),[l,d]=(0,y.useState)({}),[c,u]=(0,y.useState)(""),p=(0,y.useRef)(null),g=(0,m.j)(),{t:x}=(0,r.Bd)(),{mutate:h,status:b}=(0,A.L2)("product/import","post",{onSuccess(){a(""),T.oR.success(x("toast_messages.success")),g((0,Q.UL)(!0)),u(""),d({})}}),{mutate:v,data:f,status:I}=(0,A.L2)("product/import/validate","post",{onSuccess(e){d((0,o.get)(e,"data",{})),p.current.value=""},onError(e){d((0,o.get)(e,"message.errors",{}))}}),{uploadImage:k}=W(e=>{null!==e&&void 0!==e&&e.url&&(u(e.url),v({file_path:e.url}))});return console.log(c),console.log(l),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(N.A,{title:"Import",className:"import",startIcon:(0,s.jsx)(_.z5,{}),onClick:()=>a("open-import")}),(0,s.jsx)(i.JY,{open:!!n,setOpen:a,canClose:!1,width:800,children:(0,s.jsxs)(S,{children:[(0,s.jsx)("h2",{className:"text-center",children:x("general.import")}),(0,s.jsx)("h4",{className:"my-3",children:(0,s.jsx)(r.x6,{i18nKey:"general.import_student",components:[(0,s.jsx)("span",{className:"text-blue-500 cursor-pointer",onClick:()=>{!function(e,t){const n=localStorage.getItem("token"),i=localStorage.getItem("branchId");fetch("http://46.101.209.158:3003/v1"+e,{headers:{Authorization:"Bearer ".concat(n," "),"Content-Type":"application/json",Branch:"".concat(i),Organization:"test"}}).then(e=>e.blob()).then(e=>{const n=window.URL.createObjectURL(new Blob([e])),i=document.createElement("a");i.href=n,i.setAttribute("download",t),document.body.appendChild(i),i.click(),document.body.removeChild(i)}).catch(e=>{T.oR.error("Ma'lumot yuklashda xatolik yuz berdi")})}("uploads/product_template.xlsx","products.xlsx")}})]})}),(0,s.jsx)("div",{className:"py-3 mb-3 import-student-box",children:(0,s.jsxs)("label",{htmlFor:"import-student",children:[l&&0!==(null===l||void 0===l?void 0:l.error_count)?(0,s.jsx)(_.EO,{}):(0,s.jsx)(_.eq,{}),(0,s.jsx)("span",{children:l&&0!==(null===l||void 0===l?void 0:l.error_count)?x("general.upload_file"):x("general.uploaded_file")}),(0,s.jsx)("input",{type:"file",className:"upload-input",id:"import-student",onChange:e=>{if(e.target.files&&e.target.files[0]){const t=e.target.files[0];k({imageFile:t})}},accept:".xlsx,.xls",disabled:"loading"===I,ref:p}),"loading"===I&&(0,s.jsx)("div",{className:"d-flex align-items-center",children:(0,s.jsx)(V.A,{})})]})}),(null===l||void 0===l?void 0:l.error_count)&&l.error_count>0&&(0,s.jsx)("div",{className:"errors-upload",children:(0,s.jsxs)(j.A,{className:"error-table",sx:{mt:2},children:[(0,s.jsxs)(j.A,{sx:{display:"flex",gap:3,mb:2},children:[(0,s.jsxs)(X.A,{variant:"body1",children:[(0,s.jsx)("strong",{children:"Jami:"})," ",l.item_count||0]}),(0,s.jsxs)(X.A,{variant:"body1",children:[(0,s.jsx)("strong",{children:"Xatolar soni:"})," ",l.error_count||0]})]}),(0,s.jsx)(G.A,{sx:{border:1,borderColor:"divider"},children:(0,s.jsxs)(J.A,{sx:{minWidth:650},"aria-label":"error table",children:[(0,s.jsx)(K.A,{children:(0,s.jsxs)(H.A,{sx:{backgroundColor:"grey.100"},children:[(0,s.jsx)(Y.A,{sx:{fontWeight:"bold"},children:"Joylashgan o'rni"}),(0,s.jsx)(Y.A,{sx:{fontWeight:"bold"},children:"Qiymati"}),(0,s.jsx)(Y.A,{sx:{fontWeight:"bold"},children:"Xato xabari"})]})}),(0,s.jsx)(Z.A,{children:null===(e=l.error_items)||void 0===e?void 0:e.map((e,t)=>(0,s.jsxs)(H.A,{sx:{"&:nth-of-type(even)":{backgroundColor:"grey.50"}},children:[(0,s.jsx)(Y.A,{children:e.position}),(0,s.jsx)(Y.A,{children:e.value||"-"}),(0,s.jsx)(Y.A,{sx:{color:"error.main"},children:e.error_message})]},t))})]})})]})}),(0,s.jsxs)("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[(0,s.jsx)(N.A,{title:x("general.back"),onClick:()=>{a(""),u(""),d({})},disabled:"loading"===b||"loading"===I}),(0,s.jsx)(N.A,{title:x("general.save"),className:"main",onClick:()=>h({file_path:c}),status:b,disabled:"loading"===b||!c||(null!==(t=l.error_count)&&void 0!==t?t:0)>0})]})]})}),"loading"===I&&(0,s.jsx)(i.Rh,{})]})},ee=()=>{const e=(()=>{const{t:e}=(0,r.Bd)();return[{field:e("common.productName"),renderCell(e){let{row:t}=e;const n=null===t||void 0===t?void 0:t.name,i=(null===n||void 0===n?void 0:n.length)>30?"".concat(n.substring(0,30),"..."):n;return(0,s.jsx)(a.A,{title:n,arrow:!0,children:(0,s.jsx)("span",{children:i})})}},{field:e("common.price"),renderCell(e){let{row:t}=e;return(0,l.j)((0,o.get)(t,"price",""))}},{field:e("common.discountValue"),renderCell(e){let{row:t}=e;const n=(0,o.get)(t,"discountValue","");return 0===n?"":(0,l.j)(n)+("percent"===t.discountType?"%":"")}},{field:e("common.residue"),renderCell(e){let{row:t}=e;return(0,l.j)((0,o.get)(t,"inStock",""))}},{field:e("common.parent_category"),renderCell(e){let{row:t}=e;return(0,o.get)(t,"category.parent.name","")||(0,o.get)(t,"category.name","")}},{field:e("common.child_category"),renderCell(e){let{row:t}=e;return(0,o.get)(t,"category.parent.name","")&&(0,o.get)(t,"category.name","")}}]})(),t=(0,u.L)(),n=(0,m.j)(),{t:d}=(0,r.Bd)(),c=(0,b.mN)(),[v,j]=(0,y.useState)(),[f,A]=(0,y.useState)(""),[I,k]=(0,y.useState)([]),[w,S]=(0,y.useState)(),[C,_]=(0,y.useState)(),E=(0,y.useMemo)(()=>({isActive:c.watch("isActiveQuery")||void 0,stockState:c.watch("stockState")||void 0}),[c.watch("isActiveQuery"),c.watch("stockState")]),N=(0,s.jsxs)(g.Ay,{className:"lg:w-[60%] w-full gap-y-2 sm:gap-y-0 grid sm:grid-cols-6 items-center gap-x-2",children:[(0,s.jsx)(g.Ay,{item:!0,children:(0,s.jsx)(i.Sc,{control:c.control,label:d("enum.active"),name:"isActiveQuery"})}),(0,s.jsx)(g.Ay,{item:!0,children:(0,s.jsxs)(x.A,{style:{width:"100%",paddingBlock:"4px",borderRadius:"10px"},size:"small",labelId:"stockState-label",id:"stockState",value:c.watch("stockState")||"",onChange:e=>c.setValue("stockState",e.target.value),displayEmpty:!0,children:[c.watch("stockState")&&(0,s.jsx)(h.A,{value:"",children:"Tozalash"}),!c.watch("stockState")&&(0,s.jsx)(h.A,{value:"",hidden:!0,disabled:!0,children:"Omborni holati"}),(0,s.jsx)(h.A,{value:"yellowLine",children:"Sariq chiziq"}),(0,s.jsx)(h.A,{value:"redLine",children:"Qizil chiziq"})]})}),(0,s.jsx)(g.Ay,{item:!0,children:(0,s.jsx)(i.Bt,{optionsUrl:"category/paging",filterName:"categoryId",placeholder:d("common.category"),onChange:e=>{_(e)}})}),(0,s.jsx)(g.Ay,{item:!0,children:C&&(0,s.jsx)(i.Bt,{optionsUrl:"category/paging",filterName:"categoryId",placeholder:d("common.category"),onChange:()=>_(e=>e),exQueryParams:{parentId:C._id}})}),(0,s.jsx)(g.Ay,{item:!0,children:(0,s.jsx)($,{})}),(0,s.jsx)(g.Ay,{item:!0,children:(0,s.jsx)(i.NV,{url:"/product/export",extraParams:E})})]}),z=()=>{j(null),k([]),S(null),c.reset({name:{uz:"",ru:"",en:""},price:"",salePrice:"",inStock:"",discountValue:void 0,discountType:void 0,discountStartAt:void 0,discountEndAt:void 0,imageUrl:"",isActive:!1,discountEnabled:!1,isActiveQuery:c.watch("isActiveQuery"),stockState:c.watch("stockState"),measureId:"",categoryId:"",description:"",attributes:null,compounds:null})};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.XI,{columns:e,dataUrl:"product/paging",searchable:!0,headerChildren:N,onAddButton:t("productCreate")?()=>n((0,p.GF)(!0)):void 0,onEditColumn:t("productUpdate")?e=>{j(e._id),n((0,p.GF)(!0))}:void 0,onDeleteColumn:t("productDelete")?e=>A(e._id):void 0,exQueryParams:E}),(0,s.jsx)(U.A,{open:f,setOpen:A,url:"product/delete"}),(0,s.jsx)(i.wA,{FORM_ID:"product",isEditing:!!v,customTitle:d("general.addProduct"),onClose:z,children:(0,s.jsx)(R,{formStore:c,resetForm:z,editingProductId:v,productProps:{productImages:I,setProductImages:k,mainImageId:w,setMainImageId:S}})})]})}},72824:(e,t,n)=>{n.d(t,{j:()=>i});const i=e=>{if(e||0===e){return(Math.round(100*(e+Number.EPSILON))/100).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).replaceAll(","," ")}return""}}}]);
//# sourceMappingURL=469.4135e105.chunk.js.map