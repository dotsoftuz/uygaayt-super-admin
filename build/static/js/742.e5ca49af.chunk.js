"use strict";(self.webpackChunkbestune_admin=self.webpackChunkbestune_admin||[]).push([[742],{1903:function(e,t,n){n.d(t,{Z:function(){return s}});var i,o=n(30168),a=n(47191),r=(0,n(17939).default)(a.LD)(i||(i=(0,o.Z)(["\n  display: flex;\n  flex-direction: column-reverse;\n  border: none;\n  width: 100%;\n  padding-bottom: 20px;\n  .quill {\n    .ql-container {\n      .ql-tooltip {\n        transform: translateX(97px);\n        z-index: 10;\n      }\n      .ql-editor {\n        background-color: #fff;\n        padding: 15px;\n        border-radius: 12px;\n        min-height: 80px;\n        transition: all 0.3s;\n        border: 1px solid #d9d9d9;\n        p {\n          margin: 0;\n          font-size: 14px;\n        }\n      }\n    }\n  }\n  .ql-toolbar {\n    padding: 0;\n    transition: opacity 1s ease-out;\n    border-radius: 0;\n    border-bottom: none;\n    margin-top: 10px;\n    button {\n      border: none;\n      margin: 0 5px;\n      svg {\n        width: 24px !important;\n        height: 24px !important;\n        fill: #000 !important;\n        path {\n          fill: #000;\n        }\n      }\n    }\n  }\n  .ql-editing {\n    left: 30px !important;\n    transform: translateX(0px) !important;\n    z-index: 100;\n  }\n"]))),l=n(80184),s=function(e){var t=e.value,n=e.onChange,i=e.onImageUpload,o=e.isError,a=e.type;return(0,l.jsx)(r,{controls:[["bold","italic","underline","strike","clean","unorderedList","orderedList","alignLeft","alignCenter","alignRight"]],isError:!!o,value:t,onChange:n,onImageUpload:i,type:a})}},86742:function(e,t,n){n.r(t),n.d(t,{default:function(){return re}});var i,o,a,r=n(29439),l=n(71796),s=n(50131),d=n(763),c=n(39230),u=n(90816),m=n(80184),p=n(29001),x=n(79405),g=n(36978),h=n(61889),f=n(58406),v=n(23786),b=n(72791),y=n(61134),j=n(93433),Z=n(74165),I=n(15861),k=n(4942),S=n(1413),w=n(697),C=n(89891),_=n(32188),P=n(30168),A=n(17939),E=A.default.div(i||(i=(0,P.Z)(["\n  width: 100%;\n  \n  form {\n    width: 100%;\n  }\n  \n  .product-images {\n    display: flex;\n    flex-wrap: wrap;\n    .input-file {\n      margin-right: 10px;\n    }\n    .product-image {\n      position: relative;\n      width: 76px;\n      height: 76px;\n      border-radius: 12px;\n      overflow: hidden;\n      margin-right: 10px;\n      margin-bottom: 10px;\n      cursor: pointer;\n      &:hover {\n        .on-hover {\n          display: flex;\n        }\n      }\n      img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n      .on-hover {\n        position: absolute;\n        left: 0;\n        right: 0;\n        top: 0;\n        bottom: 0;\n        display: none;\n        align-items: center;\n        justify-content: center;\n        background-color: rgba(0, 0, 0, 0.5);\n        .delete svg {\n          width: 20px;\n          height: 20px;\n          path {\n            fill: #fff;\n          }\n        }\n        .main-image {\n          position: absolute;\n          right: 5px;\n          top: 5px;\n          width: 15px;\n          height: 15px;\n          border-radius: 50%;\n          border: 2px solid gold;\n          &.active {\n            background-color: gold;\n          }\n        }\n      }\n    }\n  }\n"]))),N=A.default.div(o||(o=(0,P.Z)(["\n  h2 {\n    color: black;\n  }\n  h4 {\n    color: black;\n  }\n  .import-student-box {\n    width: 100%;\n\n    label {\n      width: max-content;\n      min-height: max-content !important;\n      display: flex;\n      align-items: center;\n      gap: 20px;\n      border-radius: 10px;\n      transition: all 0.3s ease;\n      margin: 0 auto;\n      padding: 12px;\n      color: black;\n\n      .upload-input {\n        position: absolute !important;\n        top: 0 !important;\n        left: 0 !important;\n        opacity: 0 !important;\n        z-index: -1 !important;\n      }\n\n      &:hover {\n        background-color: gray;\n      }\n    }\n  }\n  .errors-upload {\n    margin-bottom: 12px;\n    .content {\n      width: 100%;\n      padding: 10px;\n      background-color: gray;\n      border-radius: 6px;\n      max-height: 400px;\n      overflow: auto;\n    }\n  }\n"]))),q=n(1903),M=n(59460),z=n(30709),D=n(67783),F=n(5397),L=n(3746),O=function(e){var t=e.attributeId,n=e.control,i=e.register,o=(e.getByIdData,(0,y.Dq)({control:n,name:"attributes.".concat(t)})),a=o.fields,r=o.append,s=o.remove,d=(0,c.$G)().t;return(0,m.jsxs)("div",{children:[null===a||void 0===a?void 0:a.map((function(e,o){return(0,m.jsxs)(h.ZP,{container:!0,className:"flex items-end justify-between mt-2",children:[(0,m.jsx)(h.ZP,{item:!0,md:5,children:(0,m.jsx)(l.oi,{control:n,name:"attributes.".concat(t,".").concat(o,".attributeItem"),type:"text",rules:{required:!1},label:d("general.feature")})}),(0,m.jsx)(h.ZP,{item:!0,md:5,children:(0,m.jsx)(l.II,{label:d("general.Price_added"),params:(0,S.Z)({type:"number"},i("attributes.".concat(t,".").concat(o,".amount")))})}),(0,m.jsx)(h.ZP,{item:!0,md:1,children:(0,m.jsx)(F.Z,{sx:{cursor:"pointer",color:"#D54239",fontSize:"1.5rem"},className:"mb-2.5",onClick:function(){return function(e){s(e)}(o)}})})]},e.id)})),(0,m.jsx)(h.ZP,{item:!0,xs:3,md:2,paddingBlock:2,className:"flex flex-col",children:(0,m.jsx)(D.Z,{startIcon:(0,m.jsx)(M.pO,{}),type:"button",onClick:function(){r({amount:0,attributeItem:""})}})})]})},T=A.default.div(a||(a=(0,P.Z)(['\n  h3 {\n    font-size: 14px;\n    font-weight: 500;\n    color: #32324d;\n    margin-bottom: 8px;\n  }\n  .just-image,\n  .pre-loader {\n    width: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    img {\n      object-fit: contain !important;\n    }\n  }\n  .input-file {\n    position: relative;\n    display: inline-block;\n    cursor: pointer;\n    .image-main {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      width: 76px;\n      height: 76px;\n      border-radius: 12px;\n      background: #f3f3f8;\n    }\n  }\n  .input-file input[type="file"] {\n    position: absolute;\n    z-index: -1;\n    opacity: 0;\n    display: block;\n    width: 0;\n    height: 0;\n  }\n\n  /* Focus */\n  .input-file input[type="file"]:focus + span {\n    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);\n  }\n\n  .input-file:active span {\n    background-color: #2e703a;\n  }\n\n  /* Disabled */\n  .input-file input[type="file"]:disabled + span {\n    background-color: #eee;\n  }\n\n  /* \u0421\u043f\u0438\u0441\u043e\u043a c \u043f\u0440\u0435\u0432\u044c\u044e */\n  .input-file-list {\n    padding: 10px 0;\n  }\n  .input-file-list-item {\n    display: inline-block;\n    margin: 0 15px 15px;\n    width: 150px;\n    vertical-align: top;\n    position: relative;\n  }\n  .input-file-list-item img {\n    width: 150px;\n  }\n  .input-file-list-name {\n    text-align: center;\n    display: block;\n    font-size: 12px;\n    text-overflow: ellipsis;\n    overflow: hidden;\n  }\n  .input-file-list-remove {\n    color: #fff;\n    text-decoration: none;\n    display: inline-block;\n    position: absolute;\n    padding: 0;\n    margin: 0;\n    top: 5px;\n    right: 5px;\n    background: #ff0202;\n    width: 16px;\n    height: 16px;\n    text-align: center;\n    line-height: 16px;\n    border-radius: 50%;\n  }\n']))),U=n(13239),B=n(63263),Q=n(75985),R=function(e){var t=(0,b.useState)(),n=(0,r.Z)(t,2),i=n[0],o=n[1],a=(0,b.useState)(),l=(0,r.Z)(a,2),s=l[0],d=l[1];return{imageFile:i,isUploading:s,uploadImage:function(t){d(!0),t.imageFile?(0,B.Z)({url:"".concat("http://localhost:3003/v1","/image/product/upload"),method:"POST",headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(localStorage.getItem("token")),"Accept-Language":localStorage.getItem("i18nextLng")},data:{file:t.imageFile,type:"img"}}).then((function(t){var n={url:t.data.data.url,_id:t.data.data._id};null===e||void 0===e||e(n),o(n),d(!1)})).catch((function(e){console.log(e.response.data.message),d(!1),Q.Am.error(e.response.data.message,{position:"top-center",autoClose:5e3})})):(d(!1),Q.Am.error("Rasm fayl tanlanmadi!",{position:"top-center",autoClose:3e3}))},setImage:o}};var V=function(e){var t=e.title,n=e.control,i=e.name,o=e.setValue,a=e.rules,r=void 0===a?{required:{value:!0,message:"Rasm yuklash majburiy"}}:a,s=e.className,d=e.getImage,c=(e.multiple,e.accept),u=void 0===c?"image/*, image/webp":c,p=(0,x.C)((function(e){return e.formDrawerState.isOpen}));(0,b.useEffect)((function(){p||o(i,void 0)}),[p]);var g=R((function(e){o(i,e),d&&d(e)})),h=g.uploadImage,f=g.imageFile,v=g.isUploading;return(0,m.jsx)(y.Qr,{name:i,control:n,rules:r,render:function(e){var n,o=e.fieldState,a=e.field;return(0,m.jsxs)(T,{className:s,children:[t&&(0,m.jsx)("h3",{children:t}),(0,m.jsxs)("label",{className:"input-file",children:[(0,m.jsx)("input",{ref:a.ref,id:i,name:a.name,onChange:function(e){var t;null!==(t=e.target.files)&&void 0!==t&&t[0]&&h({imageFile:e.target.files[0],id:i})},type:"file",accept:u}),(0,m.jsx)("div",{className:"image-main",children:v?(0,m.jsx)("div",{className:"pre-loader",children:(0,m.jsx)(U.Z,{color:"primary",size:30})}):null!==a&&void 0!==a&&a.value?(0,m.jsx)(l.Ee,{src:"string"===typeof a.value?a.value:a.value.url||""}):(0,m.jsx)("div",{className:"image-top",children:(0,m.jsx)(M.Q_,{})})})]}),o.error&&!f&&(0,m.jsx)(m.Fragment,{children:(0,m.jsx)("h6",{className:"text-error mt-1",children:null===(n=o.error)||void 0===n?void 0:n.message})})]})}})},G=n(14396),W=function(e){var t,n,i=e.formStore,o=e.resetForm,a=e.editingProductId,s=e.productProps,d=s.productImages,u=s.setProductImages,p=s.mainImageId,x=s.setMainImageId,g=(0,c.$G)().t,f=i.control,v=i.handleSubmit,P=i.reset,A=i.setValue,N=i.register,T=i.watch,U=(i.formState.errors,localStorage.getItem("i18nextLng")||"uz"),B=(0,b.useState)(!1),Q=(0,r.Z)(B,2),R=Q[0],W=Q[1],X=(0,b.useState)(!1),$=(0,r.Z)(X,2),J=$[0],Y=$[1],K=(0,b.useState)(null),H=(0,r.Z)(K,2),ee=(H[0],H[1]),te=(0,b.useState)(null),ne=(0,r.Z)(te,2),ie=ne[0],oe=ne[1],ae=(0,b.useState)(null),re=(0,r.Z)(ae,2),le=re[0],se=re[1],de=(0,b.useState)(null),ce=(0,r.Z)(de,2),ue=(ce[0],ce[1]),me=(0,b.useState)([]),pe=(0,r.Z)(me,2),xe=pe[0],ge=pe[1],he=(0,b.useState)(null),fe=(0,r.Z)(he,2),ve=fe[0],be=fe[1],ye=(0,b.useState)(""),je=(0,r.Z)(ye,2),Ze=je[0],Ie=je[1],ke=(0,b.useState)({width:837,height:634}),Se=(0,r.Z)(ke,2),we=Se[0],Ce=Se[1],_e=new Date(T("discountStartAt"));_e.setDate(_e.getDate()+1);var Pe=(0,_.uC)(a?"/product/update":"product/create",a?"put":"post",{},!0),Ae=Pe.mutate,Ee=Pe.status,Ne=(0,_.h_)("product/get-by-id/".concat(a),{},{enabled:!!a,suspense:!1}),qe=Ne.data,Me=Ne.status;(0,b.useEffect)((function(){T("discountEnabled")||(A("discountType",void 0),A("discountValue",void 0),A("discountStartAt",""),A("discountEndAt",void 0))}),[T("discountEnabled")]),(0,b.useEffect)((function(){var e=T("attributeId")||[],t=T("attributes")||{},n=Object.entries(t).filter((function(t){var n=(0,r.Z)(t,1)[0];return e.includes(n)})).reduce((function(e,t){var n=(0,r.Z)(t,2),i=n[0],o=n[1];return(0,S.Z)((0,S.Z)({},e),{},(0,k.Z)({},i,o))}),{});A("attributes",n)}),[T("attributeId")]),(0,b.useEffect)((function(){"success"===Ee&&(be(null),o())}),[Ee]),(0,b.useEffect)((function(){var e,t;null!==qe&&void 0!==qe&&qe.data&&(ee(qe.data.parentCategoryId||null),oe(qe.data.categoryId||null),W(!(null===(e=qe.data.attributes)||void 0===e||!e.length)),Y(!(null===(t=qe.data.compounds)||void 0===t||!t.length)))}),[qe]);(0,b.useEffect)((function(){if("success"===Me){var e,t,n,o,a,r,l,s,d,c,m=qe.data;if(m.parentCategoryId&&se({_id:m.parentCategoryId}),m.categoryId&&ue({_id:m.categoryId}),P((0,S.Z)((0,S.Z)({},qe.data),{},{attributes:(null===(e=qe.data.attributes)||void 0===e?void 0:e.reduce((function(e,t){return(0,S.Z)((0,S.Z)({},e),{},(0,k.Z)({},t.attribute._id,t.items))}),{}))||[],parentCategoryId:m.parentCategoryId||m.categoryId||"",categoryId:m.categoryId||"",isActiveQuery:i.watch("isActiveQuery"),description:qe.data.description,compounds:qe.data.compounds,attributeId:qe.data.attributeDetails.map((function(e){return e._id}))||[],locationBlock:qe.data.locationBlock||void 0,locationShelf:qe.data.locationShelf||void 0,locationRow:qe.data.locationRow||void 0,location:qe.data.location||void 0})),A("isMyExpire",!!T("expiryDate")),qe.data.location?be({section_id:qe.data.location.id,section_name:qe.data.location.name,rect:qe.data.location.rect}):be(null),u((null===(t=qe.data)||void 0===t?void 0:t.images)||[]),(null===(n=qe.data)||void 0===n||null===(o=n.images)||void 0===o?void 0:o.find((function(e){var t;return(null===e||void 0===e?void 0:e._id)===(null===(t=qe.data.mainImage)||void 0===t?void 0:t._id)})))&&null!==(a=qe.data)&&void 0!==a&&null!==(r=a.images)&&void 0!==r&&r.length)x(null===(c=qe.data.mainImage)||void 0===c?void 0:c._id);else x(null===(l=qe.data)||void 0===l||null===(s=l.images)||void 0===s||null===(d=s[0])||void 0===d?void 0:d._id)}}),[Me,qe]),(0,b.useEffect)((function(){var e=d.find((function(e){return e._id===p}));e?x(e._id):d.length&&x(d[0]._id)}),[d]),(0,b.useEffect)((function(){var e=function(){var e=(0,I.Z)((0,Z.Z)().mark((function e(){var t,n;return(0,Z.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/store-map-sections.json");case 3:return t=e.sent,e.next=6,t.json();case 6:n=e.sent,ge(n.sections||[]),n.imageSize&&Ce(n.imageSize),n.mapImageUrl&&Ie(n.mapImageUrl),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("Error loading store map data:",e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}();e()}),[]);var ze=(0,y.Dq)({name:"compounds",control:f}),De=ze.fields,Fe=ze.append,Le=ze.remove,Oe=T("attributeId")||[],Te=(0,_.uC)("attribute/choose","post"),Ue=Te.mutate,Be=Te.data;Te.status;(0,b.useEffect)((function(){Ue({})}),[]);var Qe=null===Be||void 0===Be||null===(t=Be.data)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.filter((function(e){return null===Oe||void 0===Oe?void 0:Oe.some((function(t){return t===e._id}))})),Re=T("isActive"),Ve=(T("compounds"),(0,b.useCallback)((function(e,t){"compounds"===e?(Y(t),A("compounds",[])):"attributes"===e&&(W(t),t||(A("attributes",{}),A("attributeId",[]))),A(e,t)}),[A]));return(0,m.jsx)(E,{className:"custom-drawer",children:(0,m.jsx)("form",{id:"product",onSubmit:v((function(e){var t,n;console.log(e);var i,o,l=Object.entries(e.attributes||{}).filter((function(t){var n,i=(0,r.Z)(t,1)[0];return null===(n=e.attributeId)||void 0===n?void 0:n.includes(i)})).reduce((function(e,t){var n=(0,r.Z)(t,2),i=n[0],o=n[1];return(0,S.Z)((0,S.Z)({},e),{},(0,k.Z)({},i,o))}),{}),s={name:e.name,price:+e.price,inStock:+e.inStock,redLine:+e.redLine||null,yellowLine:+e.yellowLine||null,categoryId:ie?e.categoryId:e.parentCategoryId,isActive:e.isActive,imageIds:d.map((function(e){return e._id})),mainImageId:d.length?p||(null===d||void 0===d||null===(t=d[0])||void 0===t?void 0:t._id):null,expiryDate:e.isMyExpire?"string"===typeof e.expiryDate?e.expiryDate:"object"===typeof e.expiryDate?null===(n=e.expiryDate)||void 0===n?void 0:n.toISOString():null:null,_id:a,discountEnabled:e.discountEnabled,description:e.description,compounds:e.compounds||[],attributes:R?Object.entries(l).map((function(e){var t=(0,r.Z)(e,2),n=t[0],i=t[1];return{attributeId:n,items:Array.isArray(i)?i.map((function(e){return{attributeItem:(null===e||void 0===e?void 0:e.attributeItem)||null,amount:Number(null===e||void 0===e?void 0:e.amount)||0}})):[]}})):[],locationBlock:e.locationBlock||void 0,locationShelf:e.locationShelf||void 0,locationRow:e.locationRow||void 0,location:e.location||void 0};e.discountEnabled&&(s.discountType=e.discountType,s.discountValue=e.discountValue,s.discountStartAt="string"===typeof e.discountStartAt?e.discountStartAt:"object"===typeof e.discountStartAt?null===(i=e.discountStartAt)||void 0===i?void 0:i.toISOString():void 0,s.discountEndAt="string"===typeof e.discountEndAt?e.discountEndAt:"object"===typeof e.discountEndAt?null===(o=e.discountEndAt)||void 0===o?void 0:o.toISOString():void 0);e.discountEnabled||(delete s.discountType,delete s.discountValue,delete s.discountStartAt,delete s.discountEndAt),delete s.isMyExpire,Ae(s)})),children:(0,m.jsxs)(h.ZP,{container:!0,spacing:2,children:[(0,m.jsx)(h.ZP,{item:!0,md:12,children:(0,m.jsx)(l.oi,{control:f,name:"name.uz",label:g("common.productName")+" (Uz)",placeholder:"Masalan: Olma"})}),(0,m.jsx)(h.ZP,{item:!0,md:12,children:(0,m.jsx)(l.oi,{control:f,name:"name.ru",label:g("common.productName")+" (Ru)",placeholder:"\u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440: \u042f\u0431\u043b\u043e\u043a\u043e"})}),(0,m.jsx)(h.ZP,{item:!0,md:12,children:(0,m.jsx)(l.oi,{control:f,name:"name.en",label:g("common.productName")+" (En)",placeholder:"For example: Apple"})}),(0,m.jsx)(h.ZP,{item:!0,md:12,children:(0,m.jsx)(l.oi,{name:"price",control:f,label:g("common.price"),type:"number",placeholder:"Masalan: 5000"})}),(0,m.jsx)(h.ZP,{item:!0,md:12,children:(0,m.jsx)(l.oi,{name:"inStock",control:f,label:g("common.residue"),type:"number",placeholder:"Masalan: 100"})}),(0,m.jsxs)(h.ZP,{item:!0,md:12,display:"flex",justifyContent:"space-between",children:[(0,m.jsx)(w.Z,{children:(0,m.jsx)(l.oi,{name:"redLine",control:f,type:"number",label:g("Qizil chiziq"),placeholder:"Masalan: 10",rules:{required:!1}})}),(0,m.jsx)(w.Z,{children:(0,m.jsx)(l.oi,{name:"yellowLine",control:f,label:g("Sariq chiziq"),type:"number",placeholder:"Masalan: 20",rules:{required:!1}})})]}),(0,m.jsx)(h.ZP,{item:!0,md:12,children:(0,m.jsxs)(w.Z,{className:"product-location-selector",children:[(0,m.jsxs)("label",{className:"custom-label",children:["Mahsulot joylashuvi (Xarita)",(0,m.jsx)("span",{className:"text-muted-foreground text-sm",children:"(ixtiyoriy)"})]}),xe.length>0&&(0,m.jsx)(G.Z,{sections:xe,mapImageUrl:Ze||void 0,imageSize:we,onLocationSelect:function(e){be(e),A("location",e?{id:e.section_id,name:e.section_name,rect:e.rect}:void 0)},selectedLocation:ve})]})}),(0,m.jsx)(h.ZP,{item:!0,md:4,children:(0,m.jsx)(l.oi,{name:"locationBlock",control:f,label:"Blok",placeholder:"Masalan: A blok",rules:{required:!1}})}),(0,m.jsx)(h.ZP,{item:!0,md:4,children:(0,m.jsx)(l.oi,{name:"locationShelf",control:f,label:"Javon",placeholder:"Masalan: 2 javon",rules:{required:!1}})}),(0,m.jsx)(h.ZP,{item:!0,md:4,children:(0,m.jsx)(l.oi,{name:"locationRow",control:f,label:"Qator",placeholder:"Masalan: 3 qator",rules:{required:!1}})}),(0,m.jsxs)(h.ZP,{item:!0,md:12,children:[(0,m.jsx)(l.Ls,{control:f,name:void 0!==ie?"parentCategoryId":"categoryId",optionsUrl:"category/paging",dataProp:"data.data",label:"Kategoriya",onChange:function(e){se(e),ue(null),A("categoryId",""),A("parentCategoryId",(null===e||void 0===e?void 0:e._id)||"")}}),le&&(0,m.jsx)(l.Ls,{control:f,name:"categoryId",optionsUrl:"category/paging",dataProp:"data.data",label:"Ichki kategoriya",rules:{required:!1},onChange:function(e){ue(e),A("categoryId",(null===e||void 0===e?void 0:e._id)||"")},exQueryParams:{parentId:null===le||void 0===le?void 0:le._id}},"child-cat-".concat(null===le||void 0===le?void 0:le._id))]}),(0,m.jsxs)(h.ZP,{item:!0,md:12,children:[(0,m.jsxs)("label",{className:"custom-label",children:[g("common.description")," ",(0,m.jsx)("span",{className:"text-muted-foreground text-sm",children:"(ixtiyoriy)"})]}),(0,m.jsx)(y.Qr,{name:"description",control:f,rules:{required:!1},render:function(e){var t=e.field;return(0,m.jsx)(q.Z,{value:t.value,onChange:function(e){t.onChange(e)}})}})]}),(0,m.jsx)(h.ZP,{item:!0,md:12,children:(0,m.jsxs)(w.Z,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,m.jsxs)("label",{htmlFor:"isActive",children:[g("common.isActive")," ",(0,m.jsx)("span",{className:"text-muted-foreground text-sm",children:"(ixtiyoriy)"})]}),(0,m.jsx)(C.Z,{checked:!!Re,onChange:function(e){return Ve("isActive",e.target.checked)},id:"isActive"})]})}),(0,m.jsxs)(h.ZP,{item:!0,md:12,children:[(0,m.jsxs)(w.Z,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,m.jsxs)("label",{htmlFor:"isMyExpire",children:["Muddatli mahsulot ",(0,m.jsx)("span",{className:"text-muted-foreground text-sm",children:"(ixtiyoriy)"})]}),(0,m.jsx)(C.Z,(0,S.Z)({checked:!!T("isMyExpire"),id:"isMyExpire"},N("isMyExpire")))]}),T("isMyExpire")&&(0,m.jsx)(h.ZP,{container:!0,children:(0,m.jsx)(h.ZP,{item:!0,md:12,children:(0,m.jsx)(l.nT,{control:f,name:"expiryDate",rules:{required:{value:!0,message:"Majburiy"}},disableTime:!0,label:g("common.validatyPariod"),readOnly:!0,minDate:new Date})})})]}),(0,m.jsxs)(h.ZP,{item:!0,md:12,children:[(0,m.jsxs)(w.Z,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,m.jsxs)("label",{htmlFor:"discountEnabled",children:[g("common.discount")," ",(0,m.jsx)("span",{className:"text-muted-foreground text-sm",children:"(ixtiyoriy)"})]}),(0,m.jsx)(C.Z,(0,S.Z)({checked:!!T("discountEnabled"),id:"discountEnabled"},N("discountEnabled")))]}),T("discountEnabled")&&(0,m.jsxs)(h.ZP,{container:!0,spacing:2,alignItems:"end",children:[(0,m.jsx)(h.ZP,{item:!0,md:6,children:(0,m.jsx)(l.oi,{control:f,name:"discountValue",label:g("common.discountValue"),type:"number",placeholder:"percent"===T("discountType")?"Masalan: 10":"Masalan: 1000",rules:{required:{value:!1,message:"Majburiy"}},inputProps:"percent"===T("discountType")?{max:100}:{max:Number(T("price"))}})}),(0,m.jsx)(h.ZP,{item:!0,md:6,children:(0,m.jsx)(l.p7,{control:f,name:"discountType",options:z.v5,label:g("common.type"),rules:{required:{value:!1,message:"Majburiy"}}})}),(0,m.jsx)(h.ZP,{item:!0,md:6,children:(0,m.jsx)(l.nT,{control:f,name:"discountStartAt",disableTime:!0,rules:{required:{value:!1,message:"Majburiy"}},label:g("common.discountStartAt"),minDate:new Date,readOnly:!0,maxDate:T("discountEndAt")?new Date(T("discountEndAt")):void 0})}),(0,m.jsx)(h.ZP,{item:!0,md:6,children:(0,m.jsx)(l.nT,{control:f,name:"discountEndAt",rules:{required:{value:!1,message:"Majburiy"}},disableTime:!0,label:g("common.discountEndAt"),readOnly:!0,minDate:_e})})]})]}),(0,m.jsxs)(h.ZP,{item:!0,md:12,children:[(0,m.jsxs)(w.Z,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,m.jsxs)("label",{htmlFor:"compounds",children:[g("general.compounds")," ",(0,m.jsx)("span",{className:"text-muted-foreground text-sm",children:"(ixtiyoriy)"})]}),(0,m.jsx)(C.Z,{checked:J,onChange:function(e){return Ve("compounds",e.target.checked)},id:"compounds"})]}),J&&De.map((function(e,t){return(0,m.jsxs)(h.ZP,{container:!0,className:"flex items-end justify-between mt-2",children:[(0,m.jsx)(h.ZP,{item:!0,md:5,children:(0,m.jsx)(l.oi,{control:f,name:"compounds.".concat(t,".name"),type:"text",rules:{required:!1},label:g("general.composition"),placeholder:"Masalan: Suv"})}),(0,m.jsx)(h.ZP,{item:!0,md:5,children:(0,m.jsx)(l.II,{label:g("general.quantity"),placeholder:"Masalan: 100ml",params:(0,S.Z)({},N("compounds.".concat(t,".value")))})}),(0,m.jsx)(h.ZP,{item:!0,md:1,children:(0,m.jsx)(F.Z,{sx:{cursor:"pointer",color:"#D54239",fontSize:"1.5rem"},className:"mb-2.5",onClick:function(){Le(t)}})})]},e.id)}))]}),J&&(0,m.jsx)(h.ZP,{item:!0,xs:3,md:2,paddingBlock:2,className:"flex flex-col ",children:(0,m.jsx)(D.Z,{startIcon:(0,m.jsx)(M.pO,{}),type:"button",onClick:function(){Fe({name:null,value:null})}})}),(0,m.jsx)(h.ZP,{item:!0,md:12,children:(0,m.jsxs)(w.Z,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,m.jsxs)("label",{htmlFor:"attributes",children:[g("general.attributes")," ",(0,m.jsx)("span",{className:"text-muted-foreground text-sm",children:"(ixtiyoriy)"})]}),(0,m.jsx)(C.Z,{checked:R,onChange:function(e){return Ve("attributes",e.target.checked)},id:"attributes"})]})}),R&&(0,m.jsx)(h.ZP,{item:!0,md:12,children:(0,m.jsx)(l.Ls,{control:f,name:"attributeId",optionsUrl:"attribute/choose",dataProp:"data.data",rules:{required:!1},multiple:!0})}),R&&(null===Oe||void 0===Oe?void 0:Oe.map((function(e){var t;return(0,m.jsxs)(h.ZP,{item:!0,md:12,children:[(0,m.jsx)("p",{className:"text-[#EB5B00] font-bold text-xl",children:null===Qe||void 0===Qe||null===(t=Qe.filter((function(t){return(null===t||void 0===t?void 0:t._id)===e})))||void 0===t?void 0:t.map((function(e){var t;return(0,m.jsxs)("div",{children:[null===(t=e.name)||void 0===t?void 0:t[U],":"]},null===e||void 0===e?void 0:e._id)}))}),(0,m.jsx)(O,{attributeId:e,getByIdData:qe,control:f,register:N})]},e)}))),(0,m.jsxs)(h.ZP,{item:!0,md:12,children:[(0,m.jsx)("label",{className:"py-2",htmlFor:"",children:g("general.recommendation_img")}),(0,m.jsx)("br",{}),(0,m.jsx)("br",{}),(0,m.jsxs)("div",{className:"product-images",children:[(0,m.jsx)(V,{control:f,setValue:A,name:"image",rules:{required:!1},multiple:!0,getImage:function(e){u((function(t){return[].concat((0,j.Z)(t),[e])})),A("image",null)},accept:".png, .jpg, .jpeg"}),null===d||void 0===d?void 0:d.map((function(e){return(0,m.jsxs)("div",{className:"product-image",children:[(0,m.jsx)("img",{src:"http://localhost:3003/v1"+e.url,alt:"product"}),(0,m.jsxs)("div",{className:"on-hover flex gap-2",children:[(0,m.jsx)("span",{className:"delete",onClick:function(){return u((function(t){return t.filter((function(t){return t._id!==e._id}))}))},children:(0,m.jsx)(M.pJ,{})}),(0,m.jsx)("span",{className:"preview",onClick:function(){var t=document.createElement("div");t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0, 0, 0, 0.8)",t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center",t.style.zIndex="2000";var n=document.createElement("img");n.src="http://localhost:3003/v1"+e.url,n.alt="preview",n.style.maxWidth="90%",n.style.maxHeight="90%",n.style.border="2px solid white",n.style.borderRadius="8px";var i=document.createElement("span");i.innerText="\xd7",i.style.position="absolute",i.style.top="20px",i.style.right="20px",i.style.fontSize="2rem",i.style.color="white",i.style.cursor="pointer",i.onclick=function(){document.body.removeChild(t)},t.appendChild(n),t.appendChild(i),document.body.appendChild(t)},children:(0,m.jsx)(L.Z,{className:"text-white text-lg"})}),(0,m.jsx)("span",{className:"main-image ".concat(e._id===p&&"active"),onClick:function(){return x(null===e||void 0===e?void 0:e._id)}})]})]},e._id)}))]})]})]})})})},X=n(84544),$=n(55835),J=n(21836);var Y=function(e){var t=(0,b.useState)(),n=(0,r.Z)(t,2),i=n[0],o=n[1],a=(0,b.useState)(),l=(0,r.Z)(a,2),s=l[0],d=l[1];return{imageFile:i,isUploading:s,uploadImage:function(t){d(!0),t.imageFile?(0,B.Z)({url:"".concat("http://localhost:3003/v1","/image/file/upload"),method:"POST",headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(localStorage.getItem("token")),"Accept-Language":localStorage.getItem("i18nextLng")},data:{file:t.imageFile,type:"file"}}).then((function(t){var n={url:t.data.data.url,_id:t.data.data._id};null===e||void 0===e||e(n),o(n),d(!1)})).catch((function(e){console.log(e.response.data.message),d(!1),Q.Am.error(e.response.data.message,{position:"top-center",autoClose:5e3})})):(d(!1),Q.Am.error("Rasm fayl tanlanmadi!",{position:"top-center",autoClose:3e3}))},setImage:o}},K=n(20890),H=n(39281),ee=n(79836),te=n(56890),ne=n(35855),ie=n(53994),oe=n(53382),ae=function(){var e,t,n=(0,b.useState)(""),i=(0,r.Z)(n,2),o=i[0],a=i[1],s=(0,b.useState)({}),u=(0,r.Z)(s,2),p=u[0],g=u[1],h=(0,b.useState)(""),f=(0,r.Z)(h,2),v=f[0],y=f[1],j=(0,b.useRef)(null),Z=(0,x.T)(),I=(0,c.$G)().t,k=(0,_.uC)("product/import","post",{onSuccess:function(){a(""),Z((0,J.xV)(!0)),y(""),g({})}},!0),S=k.mutate,C=k.status,P=(0,_.uC)("product/import/validate","post",{onSuccess:function(e){g((0,d.get)(e,"data",{})),j.current.value=""},onError:function(e){g((0,d.get)(e,"message.errors",{}))}},!0),A=P.mutate,E=(P.data,P.status),q=Y((function(e){null!==e&&void 0!==e&&e.url&&(y(e.url),A({file_path:e.url}))})).uploadImage;return console.log(v),console.log(p),(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(D.Z,{title:"Import",className:"import",startIcon:(0,m.jsx)(M._c,{}),onClick:function(){return a("open-import")}}),(0,m.jsx)(l.WK,{open:!!o,setOpen:a,canClose:!1,width:800,children:(0,m.jsxs)(N,{children:[(0,m.jsx)("h2",{className:"text-center",children:I("general.import")}),(0,m.jsx)("h4",{className:"my-3",children:(0,m.jsx)(c.cC,{i18nKey:"general.import_student",components:[(0,m.jsx)("span",{className:"text-blue-500 cursor-pointer",onClick:function(){!function(e,t){var n=localStorage.getItem("token"),i=localStorage.getItem("branchId");fetch("http://localhost:3003/v1"+e,{headers:{Authorization:"Bearer ".concat(n," "),"Content-Type":"application/json",Branch:"".concat(i),Organization:"test"}}).then((function(e){return e.blob()})).then((function(e){var n=window.URL.createObjectURL(new Blob([e])),i=document.createElement("a");i.href=n,i.setAttribute("download",t),document.body.appendChild(i),i.click(),document.body.removeChild(i)})).catch((function(e){Q.Am.error("Ma'lumot yuklashda xatolik yuz berdi")}))}("uploads/product_template.xlsx","products.xlsx")}})]})}),(0,m.jsx)("div",{className:"py-3 mb-3 import-student-box",children:(0,m.jsxs)("label",{htmlFor:"import-student",children:[p&&0!==(null===p||void 0===p?void 0:p.error_count)?(0,m.jsx)(M.G1,{}):(0,m.jsx)(M.qw,{}),(0,m.jsx)("span",{children:p&&0!==(null===p||void 0===p?void 0:p.error_count)?I("general.upload_file"):I("general.uploaded_file")}),(0,m.jsx)("input",{type:"file",className:"upload-input",id:"import-student",onChange:function(e){if(e.target.files&&e.target.files[0]){var t=e.target.files[0];q({imageFile:t})}},accept:".xlsx,.xls",disabled:"loading"===E,ref:j}),"loading"===E&&(0,m.jsx)("div",{className:"d-flex align-items-center",children:(0,m.jsx)($.Z,{})})]})}),(null===p||void 0===p?void 0:p.error_count)&&p.error_count>0&&(0,m.jsx)("div",{className:"errors-upload",children:(0,m.jsxs)(w.Z,{className:"error-table",sx:{mt:2},children:[(0,m.jsxs)(w.Z,{sx:{display:"flex",gap:3,mb:2},children:[(0,m.jsxs)(K.Z,{variant:"body1",children:[(0,m.jsx)("strong",{children:"Jami:"})," ",p.item_count||0]}),(0,m.jsxs)(K.Z,{variant:"body1",children:[(0,m.jsx)("strong",{children:"Xatolar soni:"})," ",p.error_count||0]})]}),(0,m.jsx)(H.Z,{sx:{border:1,borderColor:"divider"},children:(0,m.jsxs)(ee.Z,{sx:{minWidth:650},"aria-label":"error table",children:[(0,m.jsx)(te.Z,{children:(0,m.jsxs)(ne.Z,{sx:{backgroundColor:"grey.100"},children:[(0,m.jsx)(ie.Z,{sx:{fontWeight:"bold"},children:"Joylashgan o'rni"}),(0,m.jsx)(ie.Z,{sx:{fontWeight:"bold"},children:"Qiymati"}),(0,m.jsx)(ie.Z,{sx:{fontWeight:"bold"},children:"Xato xabari"})]})}),(0,m.jsx)(oe.Z,{children:null===(e=p.error_items)||void 0===e?void 0:e.map((function(e,t){return(0,m.jsxs)(ne.Z,{sx:{"&:nth-of-type(even)":{backgroundColor:"grey.50"}},children:[(0,m.jsx)(ie.Z,{children:e.position}),(0,m.jsx)(ie.Z,{children:e.value||"-"}),(0,m.jsx)(ie.Z,{sx:{color:"error.main"},children:e.error_message})]},t)}))})]})})]})}),(0,m.jsxs)("div",{className:"d-flex justify-content-end align-items-center gap-3",children:[(0,m.jsx)(D.Z,{title:I("general.back"),onClick:function(){a(""),y(""),g({})},disabled:"loading"===C||"loading"===E}),(0,m.jsx)(D.Z,{title:I("general.save"),className:"main",onClick:function(){return S({file_path:v})},status:C,disabled:"loading"===C||!v||(null!==(t=p.error_count)&&void 0!==t?t:0)>0})]})]})}),"loading"===E&&(0,m.jsx)(l.gb,{})]})},re=function(){var e=function(){var e=(0,c.$G)().t;return[{field:e("common.productName"),renderCell:function(e){var t=e.row,n=null===t||void 0===t?void 0:t.name,i=(null===n||void 0===n?void 0:n.length)>30?"".concat(n.substring(0,30),"..."):n;return(0,m.jsx)(s.Z,{title:n,arrow:!0,children:(0,m.jsx)("span",{children:i})})}},{field:e("common.price"),renderCell:function(e){var t=e.row;return(0,u.Y)((0,d.get)(t,"price",""))}},{field:e("common.discountValue"),renderCell:function(e){var t=e.row,n=(0,d.get)(t,"discountValue","");return 0===n?"":(0,u.Y)(n)+("percent"===t.discountType?"%":"")}},{field:e("common.residue"),renderCell:function(e){var t=e.row;return(0,u.Y)((0,d.get)(t,"inStock",""))}},{field:e("common.parent_category"),renderCell:function(e){var t=e.row;return(0,d.get)(t,"category.parent.name","")||(0,d.get)(t,"category.name","")}},{field:e("common.child_category"),renderCell:function(e){var t=e.row;return(0,d.get)(t,"category.parent.name","")&&(0,d.get)(t,"category.name","")}}]}(),t=(0,p.w)(),n=(0,x.T)(),i=(0,c.$G)().t,o=(0,y.cI)(),a=(0,b.useState)(),j=(0,r.Z)(a,2),Z=j[0],I=j[1],k=(0,b.useState)(""),S=(0,r.Z)(k,2),w=S[0],C=S[1],_=(0,b.useState)([]),P=(0,r.Z)(_,2),A=P[0],E=P[1],N=(0,b.useState)(),q=(0,r.Z)(N,2),M=q[0],z=q[1],D=(0,b.useState)(),F=(0,r.Z)(D,2),L=F[0],O=F[1],T=(0,b.useMemo)((function(){return{isActive:o.watch("isActiveQuery")||void 0,stockState:o.watch("stockState")||void 0}}),[o.watch("isActiveQuery"),o.watch("stockState")]),U=(0,m.jsxs)(h.ZP,{className:"lg:w-[60%] w-full gap-y-2 sm:gap-y-0 grid sm:grid-cols-6 items-center gap-x-2",children:[(0,m.jsx)(h.ZP,{item:!0,children:(0,m.jsx)(l.XZ,{control:o.control,label:i("enum.active"),name:"isActiveQuery"})}),(0,m.jsx)(h.ZP,{item:!0,children:(0,m.jsxs)(f.Z,{style:{width:"100%",paddingBlock:"4px",borderRadius:"10px"},size:"small",labelId:"stockState-label",id:"stockState",value:o.watch("stockState")||"",onChange:function(e){return o.setValue("stockState",e.target.value)},displayEmpty:!0,children:[o.watch("stockState")&&(0,m.jsx)(v.Z,{value:"",children:"Tozalash"}),!o.watch("stockState")&&(0,m.jsx)(v.Z,{value:"",hidden:!0,disabled:!0,children:"Omborni holati"}),(0,m.jsx)(v.Z,{value:"yellowLine",children:"Sariq chiziq"}),(0,m.jsx)(v.Z,{value:"redLine",children:"Qizil chiziq"})]})}),(0,m.jsx)(h.ZP,{item:!0,children:(0,m.jsx)(l.he,{optionsUrl:"category/paging",filterName:"categoryId",placeholder:i("common.category"),onChange:function(e){O(e)}})}),(0,m.jsx)(h.ZP,{item:!0,children:L&&(0,m.jsx)(l.he,{optionsUrl:"category/paging",filterName:"categoryId",placeholder:i("common.category"),onChange:function(){return O((function(e){return e}))},exQueryParams:{parentId:L._id}})}),(0,m.jsx)(h.ZP,{item:!0,children:(0,m.jsx)(ae,{})}),(0,m.jsx)(h.ZP,{item:!0,children:(0,m.jsx)(l.j3,{url:"/product/export",extraParams:T})})]}),B=function(){I(null),E([]),z(null),o.reset({name:{uz:"",ru:"",en:""},price:"",salePrice:"",inStock:"",discountValue:void 0,discountType:void 0,discountStartAt:void 0,discountEndAt:void 0,imageUrl:"",isActive:!1,discountEnabled:!1,isActiveQuery:o.watch("isActiveQuery"),stockState:o.watch("stockState"),measureId:"",categoryId:"",description:"",attributes:null,compounds:null})};return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(l.iA,{columns:e,dataUrl:"product/paging",searchable:!0,headerChildren:U,onAddButton:t("productCreate")?function(){return n((0,g.dl)(!0))}:void 0,onEditColumn:t("productUpdate")?function(e){I(e._id),n((0,g.dl)(!0))}:void 0,onDeleteColumn:t("productDelete")?function(e){return C(e._id)}:void 0,exQueryParams:T}),(0,m.jsx)(X.Z,{open:w,setOpen:C,url:"product/delete"}),(0,m.jsx)(l._8,{FORM_ID:"product",isEditing:!!Z,customTitle:i("general.addProduct"),onClose:B,children:(0,m.jsx)(W,{formStore:o,resetForm:B,editingProductId:Z,productProps:{productImages:A,setProductImages:E,mainImageId:M,setMainImageId:z}})})]})}},30709:function(e,t,n){n.d(t,{Fv:function(){return r},G4:function(){return i},od:function(){return a},v5:function(){return o}});var i=[{_id:"cash",name:"Naqd",trans_key:"cash"}],o=[{_id:"percent",name:"Foiz",trans_key:"percent"},{_id:"amount",name:"Miqdor",trans_key:"amount"}],a=[{name:"functionality",key:"functionality",role:"role"},{name:"discounts",key:"discountOrder",role:"role"},{name:"bonus",key:"bonusOrder",role:"role"},{name:"premium_discounts",key:"premiumDiscountOrder",role:"role"},{name:"main_address",key:"mainAddress",role:"role"},{name:"website_conditions",key:"websiteConditions",role:"role"}],r=[{rate:5},{rate:4},{rate:3},{rate:2},{rate:1}]},90816:function(e,t,n){n.d(t,{Y:function(){return i}});var i=function(e){return e||0===e?(Math.round(100*(e+Number.EPSILON))/100).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).replaceAll(","," "):""}}}]);
//# sourceMappingURL=742.e5ca49af.chunk.js.map