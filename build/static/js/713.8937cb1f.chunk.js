"use strict";(self.webpackChunkbestune_admin=self.webpackChunkbestune_admin||[]).push([[713],{61713:function(t,e,o){o.r(e),o.d(e,{default:function(){return L}});var a=o(29439),n=o(61889),r=o(20890),d=o(45489),i=o(62750),s=o(35834),l=o(72791),c=o(39230),u=o(90816),m=o(96179),h=o(44617),x=o(47976),g=o(80184),v=function(t){var e,o=t.data,a=t.setSortField,n=t.sortField,r=t.setSortOrder,d=t.sortOrder,i=(0,c.$G)().t,s=function(t){n===t?r("1"===d?"-1":"1"):(a(t),r("-1"))},l=function(t){var e=t.field;return n!==e?(0,g.jsx)(m.Z,{className:"w-4 h-4"}):"1"===d?(0,g.jsx)(h.Z,{className:"w-4 h-4"}):(0,g.jsx)(x.Z,{className:"w-4 h-4"})};return(0,g.jsx)("div",{className:"h-[400px] overflow-y-auto bg-gray-100",children:(0,g.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,g.jsx)("div",{className:"bg-white rounded-b-lg shadow-md overflow-hidden",children:(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)("table",{className:"w-full",children:[(0,g.jsx)("thead",{className:"bg-gray-50",children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-900",children:i("common.firstName")}),(0,g.jsx)("th",{children:i("common.phoneNumber")}),null!==o&&void 0!==o&&null!==(e=o[0])&&void 0!==e&&e.customer?(0,g.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:bg-gray-100",onClick:function(){return s("total_price")},children:(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[i("common.price"),(0,g.jsx)(l,{field:"total_price"})]})}):(0,g.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:bg-gray-100",children:(0,g.jsx)("div",{className:"flex items-center gap-2",children:i("common.price")})}),(0,g.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:bg-gray-100",onClick:function(){return s("total_order")},children:(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[i("sidebar.order"),(0,g.jsx)(l,{field:"total_order"})]})})]})}),(0,g.jsx)("tbody",{className:"divide-y divide-gray-200",children:null===o||void 0===o?void 0:o.map((function(t){var e,o,a,n,r,d;return(0,g.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,g.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:null!==t&&void 0!==t&&t.customer?(null===t||void 0===t||null===(e=t.customer)||void 0===e?void 0:e.firstName)||(null===(o=t.customer)||void 0===o?void 0:o.lastName):(null===t||void 0===t||null===(a=t.courier)||void 0===a?void 0:a.firstName)||(null===(n=t.courier)||void 0===n?void 0:n.lastName)}),(0,g.jsx)("td",{children:null!==t&&void 0!==t&&t.customer?null===t||void 0===t||null===(r=t.customer)||void 0===r?void 0:r.phoneNumber:null===t||void 0===t||null===(d=t.courier)||void 0===d?void 0:d.phoneNumber}),(0,g.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:null===t||void 0===t?void 0:t.total_price}),(0,g.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:null===t||void 0===t?void 0:t.total_amount})]},null===t||void 0===t?void 0:t._id)}))})]})})})})})},f=o(29749),p=o(763),j=o(35967),b=o(43623);j.kL.register(j.l7,j.qi,j.u,j.De);var y=function(t){var e,o,a=t.data,n=t.all_orders,r=(0,c.$G)().t,d={labels:[r("dashboard.completed_orders"),r("dashboard.cancelled_orders"),r("dashboard.total_orders")],datasets:[{label:"Buyurtmalar",data:[null===a||void 0===a||null===(e=a[0])||void 0===e?void 0:e.total_amount,null===a||void 0===a||null===(o=a[1])||void 0===o?void 0:o.total_amount,n],backgroundColor:["rgba(0, 128, 0, 0.6)","rgba(255, 0, 0, 0.6)","rgba(0, 0, 255, 0.6)"],borderWidth:1}]};return(0,g.jsx)("div",{style:{width:"500px",height:"500px",margin:"0 auto"},children:(0,g.jsx)(b.xz,{data:d})})},N=o(66934),_=o(57621),F=(0,N.ZP)(_.Z)({height:"120px",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"14px 30px 18px 30px",borderRadius:"24px",flexDirection:"column",boxShadow:"0px 0px 9px -5px rgba(108, 175, 226, 0.96)",transition:"all .3s"}),S=(0,N.ZP)(r.Z)({fontSize:"16px",lineHeight:"24px",fontWeight:"600",padding:"0 24px",textAlign:"center"}),Z=o(1661),w=o(73405),M=[40.1158,67.8422],C=function(){for(var t=[],e=1,o=0;o<15;o++)t.push({_id:String(e++),addressLocation:{latitude:40.12+.015*(Math.random()-.5),longitude:67.85+.015*(Math.random()-.5)},addressName:"Zilol mahallasi"});for(var a=0;a<25;a++)t.push({_id:String(e++),addressLocation:{latitude:40.1158+.02*(Math.random()-.5),longitude:67.8422+.02*(Math.random()-.5)},addressName:"Markaziy hudud"});for(var n=0;n<18;n++)t.push({_id:String(e++),addressLocation:{latitude:40.11+.02*(Math.random()-.5),longitude:67.835+.02*(Math.random()-.5)},addressName:"Yangi shahar"});for(var r=0;r<12;r++)t.push({_id:String(e++),addressLocation:{latitude:40.125+.015*(Math.random()-.5),longitude:67.86+.015*(Math.random()-.5)},addressName:"Sharqiy hudud"});for(var d=0;d<14;d++)t.push({_id:String(e++),addressLocation:{latitude:40.105+.015*(Math.random()-.5),longitude:67.82+.015*(Math.random()-.5)},addressName:"G'arbiy hudud"});for(var i=0;i<10;i++)t.push({_id:String(e++),addressLocation:{latitude:40.1+.01*(Math.random()-.5),longitude:67.84+.01*(Math.random()-.5)},addressName:"Janubiy hudud"});for(var s=0;s<9;s++)t.push({_id:String(e++),addressLocation:{latitude:40.13+.01*(Math.random()-.5),longitude:67.845+.01*(Math.random()-.5)},addressName:"Shimoliy hudud"});for(var l=0;l<8;l++)t.push({_id:String(e++),addressLocation:{latitude:40.118+.008*(Math.random()-.5),longitude:67.838+.008*(Math.random()-.5)},addressName:"Toshkent ko'chasi"});for(var c=0;c<7;c++)t.push({_id:String(e++),addressLocation:{latitude:40.113+.008*(Math.random()-.5),longitude:67.848+.008*(Math.random()-.5)},addressName:"Navoiy ko'chasi"});for(var u=0;u<5;u++)t.push({_id:String(e++),addressLocation:{latitude:40.1175+.005*(Math.random()-.5),longitude:67.843+.005*(Math.random()-.5)},addressName:"Mustaqillik maydoni"});return t}(),z=function(t){var e=t.height,o=void 0===e?"600px":e,n=t.useDemoData,r=void 0===n||n,d=(0,s.Z)(),c=(0,l.useState)([]),u=(0,a.Z)(c,2),m=u[0],h=u[1],x=(0,l.useState)([]),v=(0,a.Z)(x,2),f=v[0],p=v[1],j=(0,l.useState)(13),b=(0,a.Z)(j,2),y=b[0],N=b[1],_=(0,l.useRef)(null),F=(0,i.uC)("order/paging","post",{onSuccess:function(t){var e;if(null!==t&&void 0!==t&&null!==(e=t.data)&&void 0!==e&&e.data){var o=t.data.data.filter((function(t){return t.addressLocation&&t.addressLocation.latitude&&t.addressLocation.longitude}));h(o),S(o,y)}},onError:function(t){console.error("\u274c Error fetching orders:",t)}}).mutate,S=function(t,e){var o={},a=function(t){return t<=10?.08:t<=11?.05:t<=12?.03:t<=13?.02:t<=14?.01:t<=15?.005:.002}(void 0!==e?e:y);t.forEach((function(t){var e=t.addressLocation.latitude,n=t.addressLocation.longitude,r=null,d=1/0;for(var i in o){var s=o[i],l=Math.sqrt(Math.pow(s.latitude-e,2)+Math.pow(s.longitude-n,2));l<a&&l<d&&(d=l,r=s)}if(r)r.count+=1,r.orders.push(t),r.latitude=(r.latitude*(r.count-1)+e)/r.count,r.longitude=(r.longitude*(r.count-1)+n)/r.count,t.addressName&&"Noma'lum hudud"!==t.addressName&&(r.areaName=t.addressName);else{var c=t.addressName||"Noma'lum hudud",u="".concat(e.toFixed(6),"_").concat(n.toFixed(6));o[u]={latitude:e,longitude:n,count:1,areaName:c,orders:[t]}}})),p(Object.values(o))};(0,l.useEffect)((function(){r?(h(C),S(C,y)):F({page:1,limit:200,dateFrom:d.dateFrom,dateTo:d.dateTo})}),[d.dateFrom,d.dateTo,r]),(0,l.useEffect)((function(){m.length>0&&S(m,y)}),[y]);var Z=function(t){return t>10?"#FF4500":t>5?"#FF6701":"#FFA500"};return(0,g.jsx)(w.Yy,{query:{load:"package.full"},children:(0,g.jsxs)(w.D5,{width:"100%",height:o,defaultState:{center:M,zoom:13,behaviors:["default","scrollZoom"]},instanceRef:function(t){_.current=t},onBoundsChange:function(t){var e=t.get("target").getZoom();e!==y&&N(e)},onActionEnd:function(t){var e=t.get("target");if(e&&"function"===typeof e.getZoom){var o=e.getZoom();o!==y&&N(o)}},children:[f.filter((function(t){return t.count>10})).map((function(t,e){var o=Z(t.count),a=Math.min(500+20*t.count,1500);return(0,g.jsx)(w.Cd,{geometry:[[t.latitude,t.longitude],a],options:{fillColor:o,fillOpacity:.15,strokeColor:o,strokeOpacity:.7,strokeWidth:3},properties:{hintContent:"".concat(t.areaName,": ").concat(t.count," zakaz (Qaynoq nuqta)")}},"circle_".concat(t.latitude,"_").concat(t.longitude,"_").concat(e))})),(0,g.jsx)(w.LA,{options:{preset:"islands#invertedOrangeClusterIcons",groupByCoordinates:!1,clusterDisableClickZoom:!1,clusterHideIconOnBalloonOpen:!1,geoObjectHideIconOnBalloonOpen:!1},children:f.map((function(t,e){var o,n=(o=t.count)>10?[50,50]:o>5?[40,40]:[30,30],r=(0,a.Z)(n,2),d=r[0],i=r[1],s=Z(t.count),l=t.count>10,c='\n              <svg width="'.concat(d,'" height="').concat(i,'" xmlns="http://www.w3.org/2000/svg">\n                <circle cx="').concat(d/2,'" cy="').concat(i/2,'" r="').concat(d/2-2,'" fill="').concat(s,'" stroke="white" stroke-width="3"/>\n                <text x="50%" y="50%" text-anchor="middle" dominant-baseline="middle" \n                      fill="white" font-weight="bold" font-size="').concat(d>40?"16":d>30?"14":"12",'">\n                  ').concat(t.count,"\n                </text>\n              </svg>\n            "),u="data:image/svg+xml;base64,".concat(btoa(unescape(encodeURIComponent(c))));return(0,g.jsx)(w.ah,{geometry:[t.latitude,t.longitude],properties:{balloonContentHeader:"<b>".concat(t.areaName).concat(l?" \ud83d\udd25":"","</b>"),balloonContentBody:"<p>Zakazlar soni: <b>".concat(t.count,"</b></p>").concat(l?'<p style="color: #FF4500; font-weight: bold;">Qaynoq nuqta</p>':""),balloonContentFooter:"<small>Koordinatalar: ".concat(t.latitude.toFixed(4),", ").concat(t.longitude.toFixed(4),"</small>"),hintContent:"".concat(t.areaName,": ").concat(t.count," zakaz")},options:{iconLayout:"default#image",iconImageHref:u,iconImageSize:[d,i],iconImageOffset:[-d/2,-i/2]}},"marker_".concat(t.latitude,"_").concat(t.longitude,"_").concat(e))}))}),(0,g.jsx)(w.ot,{}),(0,g.jsx)(w.Sj,{options:{float:"right"}}),(0,g.jsx)(w.Ly,{options:{float:"right"}})]})})},k=function(){var t,e,o,m,h,x,j,b,N,_,w,M,C=(0,c.$G)().t,k=(0,s.Z)(),L=(localStorage.getItem("i18nextLng"),(0,l.useState)("total_price")),O=(0,a.Z)(L,2),q=O[0],A=O[1],T=(0,l.useState)("1"),W=(0,a.Z)(T,2),E=W[0],D=W[1],I=(0,l.useState)("total_order"),B=(0,a.Z)(I,2),P=B[0],Y=B[1],H=(0,l.useState)("1"),G=(0,a.Z)(H,2),R=G[0],$=G[1],J=(0,f.Z)().state.data,Q=(0,i.uC)("report/order","post",{},!0),U=Q.mutate,K=Q.data,V=(0,i.uC)("balance/total","post",{},!0),X=V.mutate,tt=V.data,et=(0,i.uC)("report/customer/count","post",{},!0),ot=et.mutate,at=et.data,nt=(0,i.uC)("report/courier/top","post",{},!0),rt=nt.mutate,dt=nt.data,it=(0,i.uC)("report/customer/top","post",{},!0),st=it.mutate,lt=it.data,ct=[U,X,ot,rt,st];(0,l.useEffect)((function(){ct.forEach((function(t){return t({dateFrom:k.dateFrom,dateTo:k.dateTo})}))}),[k.dateFrom,k.dateTo]),(0,l.useEffect)((function(){st({dateFrom:k.dateFrom,dateTo:k.dateTo,sortBy:q,sortOrder:E})}),[q,E]),(0,l.useEffect)((function(){rt({dateFrom:k.dateFrom,dateTo:k.dateTo,sortBy:P,sortOrder:R})}),[P,R]);var ut=(0,i.uC)("report/customer/saved","post",{onSuccess:function(t){}}),mt=ut.mutate,ht=ut.data;return(0,l.useEffect)((function(){mt({dateFrom:k.dateFrom,dateTo:k.dateTo})}),[k.dateFrom,k.dateTo]),(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(n.ZP,{className:"bg-white p-2 flex rounded-lg",children:(0,g.jsx)(n.ZP,{className:"",children:(0,g.jsx)(d.$m,{})})}),(0,g.jsxs)(n.ZP,{className:"grid mt-2 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-4 gap-2",children:[(0,g.jsxs)(F,{children:[(0,g.jsx)(S,{children:C("dashboard.total_orders")}),(0,g.jsx)(r.Z,{style:{fontSize:"24px",fontWeight:600,textAlign:"center",color:"#FF6701"},children:null===K||void 0===K||null===(t=K.data)||void 0===t?void 0:t.total_amount})]}),null===K||void 0===K||null===(e=K.data)||void 0===e?void 0:e.states.map((function(t){var e;return(0,g.jsxs)(F,{children:[(0,g.jsx)(S,{children:"completed"===(null===(e=t.state)||void 0===e?void 0:e.state)?C("dashboard.completed_orders"):C("dashboard.cancelled_orders")}),(0,g.jsx)(r.Z,{style:{fontSize:"24px",fontWeight:600,textAlign:"center",color:"#FF6701"},children:t.total_amount})]})})),(0,g.jsxs)(F,{children:[(0,g.jsx)(S,{children:C("dashboard.total_income")}),(0,g.jsxs)(r.Z,{style:{fontSize:"18px",fontWeight:600,textAlign:"center",color:"#FF6701"},children:[(0,u.Y)(null===tt||void 0===tt||null===(o=tt.data)||void 0===o?void 0:o.income)," ",(0,p.get)(J,"currency","uzs")]})]}),(0,g.jsxs)(F,{children:[(0,g.jsx)(S,{children:C("dashboard.registered_customer")}),(0,g.jsx)(r.Z,{style:{fontSize:"24px",fontWeight:600,textAlign:"center",color:"#FF6701"},children:null===at||void 0===at||null===(m=at.data)||void 0===m?void 0:m.registered})]}),(0,g.jsxs)(F,{children:[(0,g.jsx)(S,{children:C("dashboard.active_customer")}),(0,g.jsx)(r.Z,{style:{fontSize:"24px",fontWeight:600,textAlign:"center",color:"#FF6701"},children:null===at||void 0===at||null===(h=at.data)||void 0===h?void 0:h.active})]}),(0,g.jsxs)(F,{children:[(0,g.jsx)(S,{children:C("dashboard.sold_product")}),(0,g.jsx)(r.Z,{style:{fontSize:"24px",fontWeight:600,textAlign:"center",color:"#FF6701"},children:null===K||void 0===K||null===(x=K.data)||void 0===x?void 0:x.productCount})]}),(0,g.jsxs)(F,{children:[(0,g.jsx)(S,{children:C("dashboard.customers_saved_time")}),(0,g.jsx)(r.Z,{style:{fontSize:"20px",fontWeight:600,textAlign:"center",color:"#FF6701"},children:(0,Z.J)(null===ht||void 0===ht||null===(j=ht.data)||void 0===j?void 0:j.saved_time)})]}),(0,g.jsxs)(F,{children:[(0,g.jsx)(S,{children:C("dashboard.customers_saved_amount")}),(0,g.jsxs)(r.Z,{style:{fontSize:"18px",fontWeight:600,textAlign:"center",color:"#FF6701"},children:[(0,u.Y)(null===ht||void 0===ht||null===(b=ht.data)||void 0===b?void 0:b.saved_amount)," ",(0,p.get)(J,"currency","uzs")]})]}),(0,g.jsxs)(F,{children:[(0,g.jsx)(S,{children:C("general.all_discounts_summ")}),(0,g.jsxs)(r.Z,{style:{fontSize:"18px",fontWeight:600,textAlign:"center",color:"#FF6701"},children:[(0,u.Y)(null===K||void 0===K||null===(N=K.data)||void 0===N?void 0:N.total_discount)," ",(0,p.get)(J,"currency","uzs")]})]}),(0,g.jsxs)(F,{children:[(0,g.jsx)(S,{children:C("general.all_promocode_summ")}),(0,g.jsxs)(r.Z,{style:{fontSize:"18px",fontWeight:600,textAlign:"center",color:"#FF6701"},children:[(0,u.Y)(null===K||void 0===K||null===(_=K.data)||void 0===_?void 0:_.total_promocode)," ",(0,p.get)(J,"currency","uzs")]})]})]}),(0,g.jsx)(n.ZP,{className:"p-2 bg-white mt-2 rounded-lg",children:(0,g.jsx)(y,{data:null===K||void 0===K||null===(w=K.data)||void 0===w?void 0:w.states,all_orders:null===K||void 0===K||null===(M=K.data)||void 0===M?void 0:M.total_amount})}),(0,g.jsxs)(n.ZP,{className:"bg-white mt-2 rounded-lg p-4",children:[(0,g.jsx)(r.Z,{style:{fontSize:"20px",fontWeight:600,marginBottom:"16px",color:"#FF6701"},children:C("dashboard.orders_by_location")}),(0,g.jsx)(z,{height:"600px",useDemoData:!1})]}),(0,g.jsxs)(n.ZP,{className:"grid mt-2 md:grid-cols-2 gap-4",children:[(0,g.jsxs)("div",{className:"bg-white rounded-lg",children:[(0,g.jsx)("p",{className:"font-semibold text-lg p-3",children:C("dashboard.top_users")}),(0,g.jsx)(v,{data:null===lt||void 0===lt?void 0:lt.data,setSortField:A,sortField:q,setSortOrder:D,sortOrder:E})]}),(0,g.jsxs)("div",{className:"bg-white rounded-lg",children:[(0,g.jsx)("p",{className:"font-semibold text-lg p-3",children:C("dashboard.top_courier")}),(0,g.jsx)(v,{data:null===dt||void 0===dt?void 0:dt.data,setSortField:Y,sortField:P,setSortOrder:$,sortOrder:R})]})]})]})},L=function(){return(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(k,{})})}},1661:function(t,e,o){o.d(e,{J:function(){return a}});var a=function(t){if(!t||t<=0)return"0 daqiqa";var e=Math.round(t),o=Math.floor(e/60),a=e%60;return o>0?"".concat(o," soat ").concat(a," daqiqa"):"".concat(a," daqiqa")}},90816:function(t,e,o){o.d(e,{Y:function(){return a}});var a=function(t){return t||0===t?(Math.round(100*(t+Number.EPSILON))/100).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).replaceAll(","," "):""}}}]);
//# sourceMappingURL=713.8937cb1f.chunk.js.map