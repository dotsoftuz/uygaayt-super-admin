"use strict";(self.webpackChunkbestune_admin=self.webpackChunkbestune_admin||[]).push([[473],{46121:function(e,r,o){o.r(r),o.d(r,{default:function(){return L}});var t=o(57689),n=o(29439),i=o(71796),s=o(72791),a=o(50131),l=o(97892),d=o.n(l),c=o(763),x=o(39230),m=o(90816),u=o(80184),f=o(79405),h=o(36978),g=o(61134),b=o(1413),p=o(61889),j=o(27391),Z=o(32188),v=function(e){var r=e.formStore,o=e.editingBannerId,t=e.resetForm,n=(0,x.$G)().t,a=r.control,l=r.handleSubmit,d=r.reset,c=r.watch,m=(r.setValue,(0,Z.uC)(o?"/promocode/update":"/promocode/create",o?"put":"post")),f=m.mutate,h=m.status,v=(0,Z.h_)("promocode/get-by-id/".concat(o),{},{enabled:!!o,suspense:!1}),y=v.data,_=v.status;(0,s.useEffect)((function(){"success"===h&&t()}),[h]);return(0,s.useEffect)((function(){"success"===_&&d({name:y.data.name,code:y.data.code,amount:y.data.amount,minOrderPrice:y.data.minOrderPrice,fromDate:y.data.fromDate,toDate:y.data.toDate,maxUsage:y.data.maxUsage,maxUsageForUser:y.data.maxUsageForUser})}),[_,y]),(0,u.jsx)("div",{className:"custom-drawer",children:(0,u.jsx)("form",{id:"promo-code",onSubmit:l((function(e){f((0,b.Z)((0,b.Z)({_id:o},e),{},{maxUsageForUser:+e.maxUsageForUser}))})),children:(0,u.jsxs)(p.ZP,{container:!0,spacing:2,children:[(0,u.jsx)(p.ZP,{item:!0,md:12,children:(0,u.jsx)(i.oi,{control:a,name:"name",label:n("promo_code.name")})}),(0,u.jsx)(p.ZP,{item:!0,md:12,children:(0,u.jsx)(i.oi,{control:a,name:"code",label:n("promo_code.code")})}),(0,u.jsx)(p.ZP,{item:!0,md:12,children:(0,u.jsx)(i.oi,{name:"maxUsage",control:a,label:n("promo_code.usage"),type:"number"})}),(0,u.jsx)(p.ZP,{item:!0,md:12,children:(0,u.jsx)(i.oi,{name:"amount",control:a,label:n("promo_code.value"),type:"number"})}),(0,u.jsx)(p.ZP,{item:!0,md:12,children:(0,u.jsx)(i.oi,{name:"minOrderPrice",control:a,label:n("promo_code.min_order_price"),type:"number"})}),(0,u.jsxs)(p.ZP,{item:!0,md:12,children:[(0,u.jsx)("label",{className:"text-[15px]",htmlFor:"",children:n("promo_code.max_usage_for_user")}),(0,u.jsx)(g.Qr,{name:"maxUsageForUser",control:a,render:function(e){var r=e.field;return(0,u.jsx)(j.Z,(0,b.Z)((0,b.Z)({},r),{},{className:"mt-1",type:"number",fullWidth:!0,variant:"outlined",defaultValue:1}))}})]}),(0,u.jsx)(p.ZP,{item:!0,md:12,children:(0,u.jsx)(i.nT,{control:a,name:"fromDate",disableTime:!0,label:n("promo_code.start_date"),minDate:new Date,readOnly:!0,maxDate:c("dateTo")?new Date(c("dateTo")):void 0})}),(0,u.jsx)(p.ZP,{item:!0,md:12,children:(0,u.jsx)(i.nT,{control:a,name:"toDate",disableTime:!0,label:n("promo_code.end_date"),readOnly:!0})})]})})})},y=o(29001),_=o(84544),D=function(){var e=(0,t.s0)(),r=(0,s.useState)(),o=(0,n.Z)(r,2),l=o[0],b=o[1],p=(0,s.useState)(),j=(0,n.Z)(p,2),Z=j[0],D=j[1],S=function(){var e=(0,x.$G)().t;return[{field:e("promo_code.name"),renderCell:function(e){var r=e.row,o=null===r||void 0===r?void 0:r.name,t=(null===o||void 0===o?void 0:o.length)>50?"".concat(o.substring(0,50),"..."):o;return(0,u.jsx)(a.Z,{title:o,arrow:!0,children:(0,u.jsx)("span",{children:t})})}},{field:e("ID"),renderCell:function(e){var r=e.row;return(0,c.get)(r,"code","-")}},{field:e("promo_code.value"),renderCell:function(e){var r=e.row;return(0,m.Y)((0,c.get)(r,"amount","-"))}},{field:e("promo_code.usage"),renderCell:function(e){var r=e.row;return(0,c.get)(r,"maxUsage","-")}},{field:e("promo_code.used_count"),renderCell:function(e){var r=e.row;return(0,c.get)(r,"usedCount","-")}},{field:e("promo_code.start_date"),renderCell:function(e){var r=e.row;return d()((0,c.get)(r,"fromDate","-")).format("DD.MM.YYYY HH:mm")}},{field:e("promo_code.end_date"),renderCell:function(e){var r=e.row;return d()((0,c.get)(r,"toDate","-")).format("DD.MM.YYYY HH:mm")}},{field:e("promo_code.status"),renderCell:function(e){var r=e.row;return(0,c.get)(r,"state","-")}}]}(),w=(0,y.w)(),P=(0,x.$G)().t,k=(0,f.T)(),C=(0,g.cI)(),W=function(){b(void 0),C.reset({name:"",code:"",amount:"",minOrderPrice:"",fromDate:null,toDate:null,maxUsage:"",maxUsageForUser:1})},Y=(0,s.useMemo)((function(){return{}}),[]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(i.iA,{dataUrl:"promocode/paging",columns:S,searchable:!0,onAddButton:w("bannerCreate")?function(){return k((0,h.dl)(!0))}:void 0,onEditColumn:w("bannerUpdate")?function(e){b(e._id),k((0,h.dl)(!0))}:void 0,onDeleteColumn:w("bannerDelete")?function(e){return D(e._id)}:void 0,onRowClick:function(r){return e("/promo_code/".concat(r._id))},exQueryParams:Y}),(0,u.jsx)(_.Z,{open:Z,setOpen:D,url:"promocode/delete"}),(0,u.jsx)(i._8,{FORM_ID:"promo-code",isEditing:!!l,customTitle:P(l?"promo_code.edit_promo_code":"promo_code.new_promo_code"),onClose:W,children:(0,u.jsx)(v,{formStore:C,resetForm:W,editingBannerId:l})})]})},S=o(697),w=o(13239),P=o(20890),k=o(35527),C=o(81918),W=o(57621),Y=o(39504),U=o(63466),z=o(79836),I=o(56890),M=o(35855),F=o(53994),T=o(53382),H=o(42846),R=o(46174),O=o(10284),A=o(63833),N=o(37032),E=o(82167),B=o(85947),G=o(11087),$=function(){var e,r,o=(0,t.UO)().id,i=(0,t.s0)(),a=((0,x.$G)().t,(0,G.lr)()),l=(0,n.Z)(a,2),f=l[0],h=l[1],g=(0,s.useState)(f.get("search")||""),b=(0,n.Z)(g,2),v=b[0],y=b[1],_=(0,s.useState)(Number(f.get("page"))||1),D=(0,n.Z)(_,2),$=D[0],L=D[1],Q=20,V=(0,Z.h_)("promocode/get-by-id/".concat(o),{},{enabled:!!o}),q=V.data,J=V.status,K=(V.refetch,null===q||void 0===q?void 0:q.data),X=(0,Z.uC)("promocode/history/paging","post",{onSuccess:function(){}}),ee=X.mutate,re=X.data,oe=X.isLoading;(0,s.useEffect)((function(){o&&ee({promocodeId:o,page:$,limit:Q,search:v||void 0})}),[o,$,v]);var te=(null===re||void 0===re||null===(e=re.data)||void 0===e?void 0:e.data)||[],ne=(null===re||void 0===re||null===(r=re.data)||void 0===r?void 0:r.total)||0;if((0,s.useEffect)((function(){var e=setTimeout((function(){v!==f.get("search")&&(h({page:"1",search:v}),L(1))}),500);return function(){return clearTimeout(e)}}),[v]),(0,s.useEffect)((function(){h({page:String($),search:v})}),[$]),"loading"===J)return(0,u.jsx)(S.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:(0,u.jsx)(w.Z,{})});if("error"===J||!K)return(0,u.jsx)(S.Z,{sx:{p:3,borderRadius:2,bgcolor:"error.light",color:"error.contrastText"},children:(0,u.jsx)(P.Z,{variant:"h6",children:"Promokod topilmadi"})});var ie="active"===(0,c.get)(K,"state","");return(0,u.jsxs)(S.Z,{sx:{minHeight:"100vh"},children:[(0,u.jsx)(k.Z,{elevation:3,sx:{p:3,mb:3,borderRadius:3,background:"linear-gradient(135deg, #ff6b35 0%, #f7931e 100%)",color:"white"},children:(0,u.jsxs)(S.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,u.jsxs)(S.Z,{sx:{flex:1},children:[(0,u.jsx)(P.Z,{variant:"h4",sx:{fontWeight:700,mb:.5},children:(0,c.get)(K,"name",(0,c.get)(K,"code","Promokod"))}),(0,u.jsx)(P.Z,{variant:"body2",sx:{opacity:.9},children:"Promokod ma'lumotlari va ishlatilganlik tarixi"})]}),(0,u.jsx)(C.Z,{label:ie?"Faol":"Faol emas",sx:{bgcolor:ie?"rgba(255,255,255,0.3)":"rgba(255,255,255,0.2)",color:"white",fontWeight:600,fontSize:"0.875rem"}})]})}),(0,u.jsx)(p.ZP,{container:!0,spacing:3,children:(0,u.jsxs)(p.ZP,{item:!0,xs:12,children:[(0,u.jsxs)(W.Z,{elevation:4,sx:{mb:3,borderRadius:3,overflow:"hidden",transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-4px)",boxShadow:6}},children:[(0,u.jsx)(S.Z,{sx:{background:"linear-gradient(135deg, #ff6b35 0%, #f7931e 100%)",p:2,color:"white"},children:(0,u.jsx)(P.Z,{variant:"h6",sx:{fontWeight:700},children:"Promokod Ma'lumotlari"})}),(0,u.jsx)(Y.Z,{sx:{p:3},children:(0,u.jsxs)(p.ZP,{container:!0,spacing:3,children:[(0,u.jsx)(p.ZP,{item:!0,xs:12,sm:4,children:(0,u.jsxs)(k.Z,{elevation:0,sx:{p:2,mb:2,borderRadius:2,background:"#f8fafc",border:"1px solid #e2e8f0"},children:[(0,u.jsxs)(S.Z,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1},children:[(0,u.jsx)(H.Z,{sx:{color:"#3b82f6",fontSize:20}}),(0,u.jsx)(P.Z,{variant:"subtitle2",sx:{fontWeight:600,color:"#64748b"},children:"Promokod"})]}),(0,u.jsx)(P.Z,{variant:"h6",sx:{fontWeight:700,color:"#1e293b",fontFamily:"monospace",fontSize:"1rem"},children:(0,c.get)(K,"code","-")})]})}),(0,u.jsx)(p.ZP,{item:!0,xs:12,sm:4,children:(0,u.jsxs)(k.Z,{elevation:0,sx:{p:2,mb:2,borderRadius:2,background:"#f8fafc",border:"1px solid #e2e8f0"},children:[(0,u.jsxs)(S.Z,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1},children:[(0,u.jsx)(R.Z,{sx:{color:"#10b981",fontSize:20}}),(0,u.jsx)(P.Z,{variant:"subtitle2",sx:{fontWeight:600,color:"#64748b"},children:"Chegirma summasi"})]}),(0,u.jsxs)(P.Z,{variant:"h6",sx:{fontWeight:700,color:"#1e293b",fontSize:"1rem"},children:[(0,m.Y)((0,c.get)(K,"amount",0))," so'm"]})]})}),(0,u.jsx)(p.ZP,{item:!0,xs:12,sm:4,children:(0,u.jsxs)(k.Z,{elevation:0,sx:{p:2,mb:2,borderRadius:2,background:"#f8fafc",border:"1px solid #e2e8f0"},children:[(0,u.jsxs)(S.Z,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1},children:[(0,u.jsx)(O.Z,{sx:{color:"#f59e0b",fontSize:20}}),(0,u.jsx)(P.Z,{variant:"subtitle2",sx:{fontWeight:600,color:"#64748b"},children:"Ishlatilgan"})]}),(0,u.jsxs)(P.Z,{variant:"h6",sx:{fontWeight:700,color:"#1e293b",fontSize:"1rem"},children:[(0,c.get)(K,"usedCount",0),(0,c.get)(K,"maxUsage")&&(0,u.jsxs)(P.Z,{component:"span",variant:"body2",sx:{color:"#64748b",ml:1,fontSize:"0.875rem"},children:["/ ",(0,c.get)(K,"maxUsage")]})]})]})}),(0,u.jsx)(p.ZP,{item:!0,xs:12,sm:4,children:(0,u.jsxs)(k.Z,{elevation:0,sx:{p:2,mb:2,borderRadius:2,background:"#f8fafc",border:"1px solid #e2e8f0"},children:[(0,u.jsxs)(S.Z,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1},children:[(0,u.jsx)(A.Z,{sx:{color:"#8b5cf6",fontSize:20}}),(0,u.jsx)(P.Z,{variant:"subtitle2",sx:{fontWeight:600,color:"#64748b"},children:"Foydalanuvchi limiti"})]}),(0,u.jsxs)(P.Z,{variant:"h6",sx:{fontWeight:700,color:"#1e293b",fontSize:"1rem"},children:[(0,c.get)(K,"maxUsageForUser",1)," marta"]})]})}),(0,c.get)(K,"minOrderPrice")&&(0,u.jsx)(p.ZP,{item:!0,xs:12,sm:4,children:(0,u.jsxs)(k.Z,{elevation:0,sx:{p:2,mb:2,borderRadius:2,background:"#f8fafc",border:"1px solid #e2e8f0"},children:[(0,u.jsx)(P.Z,{variant:"subtitle2",sx:{fontWeight:600,color:"#64748b",mb:1},children:"Minimal buyurtma summasi"}),(0,u.jsxs)(P.Z,{variant:"h6",sx:{fontWeight:700,color:"#1e293b",fontSize:"1rem"},children:[(0,m.Y)((0,c.get)(K,"minOrderPrice",0))," so'm"]})]})}),(0,c.get)(K,"description")&&(0,u.jsx)(p.ZP,{item:!0,xs:12,children:(0,u.jsxs)(k.Z,{elevation:0,sx:{p:2,mb:2,borderRadius:2,background:"#f8fafc",border:"1px solid #e2e8f0"},children:[(0,u.jsx)(P.Z,{variant:"subtitle2",sx:{fontWeight:600,color:"#64748b",mb:1},children:"Tavsif"}),(0,u.jsx)(P.Z,{variant:"body1",sx:{color:"#1e293b"},children:(0,c.get)(K,"description")})]})}),(0,u.jsx)(p.ZP,{item:!0,xs:12,sm:4,children:(0,u.jsxs)(k.Z,{elevation:0,sx:{p:2,mb:2,borderRadius:2,background:"#f8fafc",border:"1px solid #e2e8f0"},children:[(0,u.jsxs)(S.Z,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1},children:[(0,u.jsx)(N.Z,{sx:{color:"#f59e0b",fontSize:20}}),(0,u.jsx)(P.Z,{variant:"subtitle2",sx:{fontWeight:600,color:"#64748b"},children:"Sana oralig'i"})]}),(0,u.jsxs)(S.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:1},children:[(0,u.jsxs)(S.Z,{sx:{flex:1},children:[(0,u.jsx)(P.Z,{variant:"caption",sx:{color:"#64748b",display:"block",mb:.25,fontSize:"0.75rem"},children:"Boshlanish sanasi"}),(0,u.jsx)(P.Z,{variant:"h6",sx:{fontWeight:700,color:"#1e293b",fontSize:"1rem",lineHeight:1.2},children:(0,c.get)(K,"fromDate")?d()((0,c.get)(K,"fromDate")).format("DD.MM.YYYY HH:mm"):"-"})]}),(0,u.jsxs)(S.Z,{sx:{flex:1},children:[(0,u.jsx)(P.Z,{variant:"caption",sx:{color:"#64748b",display:"block",mb:.25,fontSize:"0.75rem"},children:"Tugash sanasi"}),(0,u.jsx)(P.Z,{variant:"h6",sx:{fontWeight:700,color:"#1e293b",fontSize:"1rem",lineHeight:1.2},children:(0,c.get)(K,"toDate")?d()((0,c.get)(K,"toDate")).format("DD.MM.YYYY HH:mm"):"-"})]})]})]})})]})})]}),(0,u.jsxs)(W.Z,{elevation:4,sx:{borderRadius:3,overflow:"hidden"},children:[(0,u.jsx)(S.Z,{sx:{background:"linear-gradient(135deg, #ff6b35 0%, #f7931e 100%)",p:2,color:"white"},children:(0,u.jsx)(P.Z,{variant:"h6",sx:{fontWeight:700},children:"Ishlatilganlik Tarixi"})}),(0,u.jsx)(S.Z,{sx:{p:2,borderBottom:"1px solid #e2e8f0"},children:(0,u.jsx)(j.Z,{fullWidth:!0,size:"small",placeholder:"Mijoz yoki buyurtma bo'yicha qidirish...",value:v,onChange:function(e){return y(e.target.value)},InputProps:{startAdornment:(0,u.jsx)(U.Z,{position:"start",children:(0,u.jsx)(E.Z,{sx:{color:"#64748b"}})})}})}),oe?(0,u.jsx)(S.Z,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,u.jsx)(w.Z,{})}):te.length>0?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(S.Z,{sx:{overflowX:"auto"},children:(0,u.jsxs)(z.Z,{children:[(0,u.jsx)(I.Z,{children:(0,u.jsxs)(M.Z,{children:[(0,u.jsx)(F.Z,{sx:{fontWeight:700},children:"Mijoz"}),(0,u.jsx)(F.Z,{sx:{fontWeight:700},children:"Telefon"}),(0,u.jsx)(F.Z,{sx:{fontWeight:700},children:"Buyurtma"}),(0,u.jsx)(F.Z,{sx:{fontWeight:700},children:"Chegirma"}),(0,u.jsx)(F.Z,{sx:{fontWeight:700},children:"Sana"})]})}),(0,u.jsx)(T.Z,{children:te.map((function(e){return(0,u.jsxs)(M.Z,{hover:!0,children:[(0,u.jsx)(F.Z,{children:(0,u.jsxs)(S.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,u.jsx)(A.Z,{sx:{color:"#64748b",fontSize:18}}),(0,u.jsxs)(P.Z,{variant:"body2",sx:{fontWeight:600},children:[(0,c.get)(e,"customer.firstName","")," ",(0,c.get)(e,"customer.lastName","")]})]})}),(0,u.jsx)(F.Z,{children:(0,c.get)(e,"customer.phoneNumber","-")}),(0,u.jsx)(F.Z,{children:(0,c.get)(e,"order.number")?(0,u.jsxs)(S.Z,{sx:{display:"flex",alignItems:"center",gap:1,cursor:"pointer",color:"#3b82f6","&:hover":{textDecoration:"underline"}},onClick:function(){return i("/order/".concat((0,c.get)(e,"order._id")))},children:[(0,u.jsx)(B.Z,{sx:{fontSize:16}}),(0,u.jsxs)(P.Z,{variant:"body2",sx:{fontFamily:"monospace"},children:["#",(0,c.get)(e,"order.number")]})]}):"-"}),(0,u.jsx)(F.Z,{children:(0,u.jsxs)(P.Z,{variant:"body2",sx:{fontWeight:700,color:"#10b981"},children:[(0,m.Y)((0,c.get)(e,"amount",0))," so'm"]})}),(0,u.jsx)(F.Z,{children:(0,u.jsxs)(S.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,u.jsx)(N.Z,{sx:{color:"#64748b",fontSize:16}}),(0,u.jsx)(P.Z,{variant:"body2",sx:{color:"#64748b"},children:(0,c.get)(e,"createdAt")?d()((0,c.get)(e,"createdAt")).format("DD.MM.YYYY HH:mm"):"-"})]})})]},e._id)}))})]})}),ne>Q&&(0,u.jsxs)(S.Z,{sx:{p:2,borderTop:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsxs)(P.Z,{variant:"body2",sx:{color:"#64748b"},children:["Jami: ",ne," ta yozuv"]}),(0,u.jsxs)(S.Z,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,u.jsx)(S.Z,{component:"button",onClick:function(){return L((function(e){return Math.max(1,e-1)}))},disabled:1===$,sx:{px:2,py:1,border:"1px solid #e2e8f0",borderRadius:1,cursor:1===$?"not-allowed":"pointer",opacity:1===$?.5:1,background:"white","&:hover":{background:"#f8fafc"}},children:"Oldingi"}),(0,u.jsxs)(P.Z,{variant:"body2",sx:{px:2},children:[$," / ",Math.ceil(ne/Q)]}),(0,u.jsx)(S.Z,{component:"button",onClick:function(){return L((function(e){return e+1}))},disabled:$>=Math.ceil(ne/Q),sx:{px:2,py:1,border:"1px solid #e2e8f0",borderRadius:1,cursor:$>=Math.ceil(ne/Q)?"not-allowed":"pointer",opacity:$>=Math.ceil(ne/Q)?.5:1,background:"white","&:hover":{background:"#f8fafc"}},children:"Keyingi"})]})]})]}):(0,u.jsx)(S.Z,{sx:{p:4,textAlign:"center"},children:(0,u.jsx)(P.Z,{variant:"body1",sx:{color:"#64748b"},children:v?"Tarix topilmadi":"Hali ishlatilmagan"})})]})]})})]})},L=function(){return(0,u.jsxs)(t.Z5,{children:[(0,u.jsx)(t.AW,{path:":id",element:(0,u.jsx)($,{})}),(0,u.jsx)(t.AW,{path:"*",element:(0,u.jsx)(D,{})})]})}},90816:function(e,r,o){o.d(r,{Y:function(){return t}});var t=function(e){return e||0===e?(Math.round(100*(e+Number.EPSILON))/100).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).replaceAll(","," "):""}}}]);
//# sourceMappingURL=473.3f27edd0.chunk.js.map