"use strict";(self.webpackChunkbestune_admin=self.webpackChunkbestune_admin||[]).push([[504],{33504:(t,e,o)=>{o.r(e),o.d(e,{default:()=>k});var a=o(68903),d=o(85865),r=o(5468),s=o(61698),n=o(19504),l=o(65043),i=o(74117),c=o(72824),u=o(83016),m=o(59540),h=o(88645),x=o(70579);const g=t=>{var e;let{data:o,setSortField:a,sortField:d,setSortOrder:r,sortOrder:s}=t;const{t:n}=(0,i.Bd)(),l=t=>{d===t?r("1"===s?"-1":"1"):(a(t),r("-1"))},c=t=>{let{field:e}=t;return d!==e?(0,x.jsx)(u.A,{className:"w-4 h-4"}):"1"===s?(0,x.jsx)(m.A,{className:"w-4 h-4"}):(0,x.jsx)(h.A,{className:"w-4 h-4"})};return(0,x.jsx)("div",{className:"h-[400px] overflow-y-auto bg-gray-100",children:(0,x.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,x.jsx)("div",{className:"bg-white rounded-b-lg shadow-md overflow-hidden",children:(0,x.jsx)("div",{className:"overflow-x-auto",children:(0,x.jsxs)("table",{className:"w-full",children:[(0,x.jsx)("thead",{className:"bg-gray-50",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-900",children:n("common.firstName")}),(0,x.jsx)("th",{children:n("common.phoneNumber")}),null!==o&&void 0!==o&&null!==(e=o[0])&&void 0!==e&&e.customer?(0,x.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:bg-gray-100",onClick:()=>l("total_price"),children:(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[n("common.price"),(0,x.jsx)(c,{field:"total_price"})]})}):(0,x.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:bg-gray-100",children:(0,x.jsx)("div",{className:"flex items-center gap-2",children:n("common.price")})}),(0,x.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:bg-gray-100",onClick:()=>l("total_order"),children:(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[n("sidebar.order"),(0,x.jsx)(c,{field:"total_order"})]})})]})}),(0,x.jsx)("tbody",{className:"divide-y divide-gray-200",children:null===o||void 0===o?void 0:o.map(t=>{var e,o,a,d,r,s;return(0,x.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,x.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:null!==t&&void 0!==t&&t.customer?(null===t||void 0===t||null===(e=t.customer)||void 0===e?void 0:e.firstName)||(null===(o=t.customer)||void 0===o?void 0:o.lastName):(null===t||void 0===t||null===(a=t.courier)||void 0===a?void 0:a.firstName)||(null===(d=t.courier)||void 0===d?void 0:d.lastName)}),(0,x.jsx)("td",{children:null!==t&&void 0!==t&&t.customer?null===t||void 0===t||null===(r=t.customer)||void 0===r?void 0:r.phoneNumber:null===t||void 0===t||null===(s=t.courier)||void 0===s?void 0:s.phoneNumber}),(0,x.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:null===t||void 0===t?void 0:t.total_price}),(0,x.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:null===t||void 0===t?void 0:t.total_amount})]},null===t||void 0===t?void 0:t._id)})})]})})})})})};var p=o(95720),v=o(53536),f=o(17304),j=o(6058);f.t1.register(f.pr,f.Bs,f.m_,f.s$);const b=t=>{var e,o;let{data:a,all_orders:d}=t;const{t:r}=(0,i.Bd)(),s={labels:[r("dashboard.completed_orders"),r("dashboard.cancelled_orders"),r("dashboard.total_orders")],datasets:[{label:"Buyurtmalar",data:[null===a||void 0===a||null===(e=a[0])||void 0===e?void 0:e.total_amount,null===a||void 0===a||null===(o=a[1])||void 0===o?void 0:o.total_amount,d],backgroundColor:["rgba(0, 128, 0, 0.6)","rgba(255, 0, 0, 0.6)","rgba(0, 0, 255, 0.6)"],borderWidth:1}]};return(0,x.jsx)("div",{style:{width:"500px",height:"500px",margin:"0 auto"},children:(0,x.jsx)(j.O5,{data:s})})};var y=o(34535),N=o(12110);const _=(0,y.Ay)(N.A)({height:"120px",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"14px 30px 18px 30px",borderRadius:"24px",flexDirection:"column",boxShadow:"0px 0px 9px -5px rgba(108, 175, 226, 0.96)",transition:"all .3s"}),F=(0,y.Ay)(d.A)({fontSize:"16px",lineHeight:"24px",fontWeight:"600",padding:"0 24px",textAlign:"center"});var S=o(90116),A=o(37216);const w=[40.1158,67.8422],M=(()=>{const t=[];let e=1;for(let o=0;o<15;o++)t.push({_id:String(e++),addressLocation:{latitude:40.12+.015*(Math.random()-.5),longitude:67.85+.015*(Math.random()-.5)},addressName:"Zilol mahallasi"});for(let o=0;o<25;o++)t.push({_id:String(e++),addressLocation:{latitude:40.1158+.02*(Math.random()-.5),longitude:67.8422+.02*(Math.random()-.5)},addressName:"Markaziy hudud"});for(let o=0;o<18;o++)t.push({_id:String(e++),addressLocation:{latitude:40.11+.02*(Math.random()-.5),longitude:67.835+.02*(Math.random()-.5)},addressName:"Yangi shahar"});for(let o=0;o<12;o++)t.push({_id:String(e++),addressLocation:{latitude:40.125+.015*(Math.random()-.5),longitude:67.86+.015*(Math.random()-.5)},addressName:"Sharqiy hudud"});for(let o=0;o<14;o++)t.push({_id:String(e++),addressLocation:{latitude:40.105+.015*(Math.random()-.5),longitude:67.82+.015*(Math.random()-.5)},addressName:"G'arbiy hudud"});for(let o=0;o<10;o++)t.push({_id:String(e++),addressLocation:{latitude:40.1+.01*(Math.random()-.5),longitude:67.84+.01*(Math.random()-.5)},addressName:"Janubiy hudud"});for(let o=0;o<9;o++)t.push({_id:String(e++),addressLocation:{latitude:40.13+.01*(Math.random()-.5),longitude:67.845+.01*(Math.random()-.5)},addressName:"Shimoliy hudud"});for(let o=0;o<8;o++)t.push({_id:String(e++),addressLocation:{latitude:40.118+.008*(Math.random()-.5),longitude:67.838+.008*(Math.random()-.5)},addressName:"Toshkent ko'chasi"});for(let o=0;o<7;o++)t.push({_id:String(e++),addressLocation:{latitude:40.113+.008*(Math.random()-.5),longitude:67.848+.008*(Math.random()-.5)},addressName:"Navoiy ko'chasi"});for(let o=0;o<5;o++)t.push({_id:String(e++),addressLocation:{latitude:40.1175+.005*(Math.random()-.5),longitude:67.843+.005*(Math.random()-.5)},addressName:"Mustaqillik maydoni"});return t})(),L=t=>{let{height:e="600px",useDemoData:o=!0}=t;const a=(0,n.A)(),[d,r]=(0,l.useState)([]),[i,c]=(0,l.useState)([]),[u,m]=(0,l.useState)(13),h=(0,l.useRef)(null),{mutate:g}=(0,s.L2)("order/paging","post",{onSuccess(t){var e;if(null!==t&&void 0!==t&&null!==(e=t.data)&&void 0!==e&&e.data){const e=t.data.data.filter(t=>t.addressLocation&&t.addressLocation.latitude&&t.addressLocation.longitude);r(e),p(e,u)}},onError(t){console.error("Error fetching orders:",t)}}),p=(t,e)=>{const o={},a=(t=>t<=10?.08:t<=11?.05:t<=12?.03:t<=13?.02:t<=14?.01:t<=15?.005:.002)(void 0!==e?e:u);t.forEach(t=>{const e=t.addressLocation.latitude,d=t.addressLocation.longitude;let r=null,s=1/0;for(const n in o){const t=o[n],l=Math.sqrt(Math.pow(t.latitude-e,2)+Math.pow(t.longitude-d,2));l<a&&l<s&&(s=l,r=t)}if(r)r.count+=1,r.orders.push(t),r.latitude=(r.latitude*(r.count-1)+e)/r.count,r.longitude=(r.longitude*(r.count-1)+d)/r.count,t.addressName&&"Noma'lum hudud"!==t.addressName&&(r.areaName=t.addressName);else{const a=t.addressName||"Noma'lum hudud",r="".concat(e.toFixed(6),"_").concat(d.toFixed(6));o[r]={latitude:e,longitude:d,count:1,areaName:a,orders:[t]}}}),c(Object.values(o))};(0,l.useEffect)(()=>{o?(r(M),p(M,u)):g({page:1,limit:1e3,dateFrom:a.dateFrom,dateTo:a.dateTo})},[a.dateFrom,a.dateTo,o]),(0,l.useEffect)(()=>{d.length>0&&p(d,u)},[u]);const v=t=>t>10?"#FF4500":t>5?"#FF6701":"#FFA500";return(0,x.jsx)(A.Xi,{query:{load:"package.full"},children:(0,x.jsxs)(A.T5,{width:"100%",height:e,defaultState:{center:w,zoom:13,behaviors:["default","scrollZoom"]},instanceRef:t=>{h.current=t},onBoundsChange:t=>{const e=t.get("target").getZoom();e!==u&&m(e)},onActionEnd:t=>{const e=t.get("target");if(e&&"function"===typeof e.getZoom){const t=e.getZoom();t!==u&&m(t)}},children:[i.filter(t=>t.count>10).map((t,e)=>{const o=v(t.count),a=Math.min(500+20*t.count,1500);return(0,x.jsx)(A.jl,{geometry:[[t.latitude,t.longitude],a],options:{fillColor:o,fillOpacity:.15,strokeColor:o,strokeOpacity:.7,strokeWidth:3},properties:{hintContent:"".concat(t.areaName,": ").concat(t.count," zakaz (Qaynoq nuqta)")}},"circle_".concat(t.latitude,"_").concat(t.longitude,"_").concat(e))}),(0,x.jsx)(A.kW,{options:{preset:"islands#invertedOrangeClusterIcons",groupByCoordinates:!1,clusterDisableClickZoom:!1,clusterHideIconOnBalloonOpen:!1,geoObjectHideIconOnBalloonOpen:!1},children:i.map((t,e)=>{const[o,a]=(d=t.count)>10?[50,50]:d>5?[40,40]:[30,30];var d;const r=v(t.count),s=t.count>10,n='\n              <svg width="'.concat(o,'" height="').concat(a,'" xmlns="http://www.w3.org/2000/svg">\n                <circle cx="').concat(o/2,'" cy="').concat(a/2,'" r="').concat(o/2-2,'" fill="').concat(r,'" stroke="white" stroke-width="3"/>\n                <text x="50%" y="50%" text-anchor="middle" dominant-baseline="middle" \n                      fill="white" font-weight="bold" font-size="').concat(o>40?"16":o>30?"14":"12",'">\n                  ').concat(t.count,"\n                </text>\n              </svg>\n            "),l="data:image/svg+xml;base64,".concat(btoa(unescape(encodeURIComponent(n))));return(0,x.jsx)(A.Ro,{geometry:[t.latitude,t.longitude],properties:{balloonContentHeader:"<b>".concat(t.areaName).concat(s?" \ud83d\udd25":"","</b>"),balloonContentBody:"<p>Zakazlar soni: <b>".concat(t.count,"</b></p>").concat(s?'<p style="color: #FF4500; font-weight: bold;">Qaynoq nuqta</p>':""),balloonContentFooter:"<small>Koordinatalar: ".concat(t.latitude.toFixed(4),", ").concat(t.longitude.toFixed(4),"</small>"),hintContent:"".concat(t.areaName,": ").concat(t.count," zakaz")},options:{iconLayout:"default#image",iconImageHref:l,iconImageSize:[o,a],iconImageOffset:[-o/2,-a/2]}},"marker_".concat(t.latitude,"_").concat(t.longitude,"_").concat(e))})}),(0,x.jsx)(A.T3,{}),(0,x.jsx)(A.c3,{options:{float:"right"}}),(0,x.jsx)(A.pj,{options:{float:"right"}})]})})},z=()=>{var t,e,o,u,m,h,f,j,y,N,A,w;const{t:M}=(0,i.Bd)(),z=(0,n.A)(),[k,O]=(localStorage.getItem("i18nextLng"),(0,l.useState)("total_price")),[C,T]=(0,l.useState)("1"),[W,q]=(0,l.useState)("total_order"),[B,E]=(0,l.useState)("1"),{state:{data:I}}=(0,p.A)(),{mutate:D,data:Z}=(0,s.L2)("report/order","post",{},!0),{mutate:H,data:R}=(0,s.L2)("balance/total","post",{},!0),{mutate:Q,data:U}=(0,s.L2)("report/customer/count","post",{},!0),{mutate:G,data:J}=(0,s.L2)("report/courier/top","post",{},!0),{mutate:K,data:P}=(0,s.L2)("report/customer/top","post",{},!0),X=[D,H,Q,G,K];(0,l.useEffect)(()=>{X.forEach(t=>t({dateFrom:z.dateFrom,dateTo:z.dateTo}))},[z.dateFrom,z.dateTo]),(0,l.useEffect)(()=>{K({dateFrom:z.dateFrom,dateTo:z.dateTo,sortBy:k,sortOrder:C})},[k,C]),(0,l.useEffect)(()=>{G({dateFrom:z.dateFrom,dateTo:z.dateTo,sortBy:W,sortOrder:B})},[W,B]);const{mutate:Y,data:$}=(0,s.L2)("report/customer/saved","post",{onSuccess(t){}});return(0,l.useEffect)(()=>{Y({dateFrom:z.dateFrom,dateTo:z.dateTo})},[z.dateFrom,z.dateTo]),(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(a.Ay,{className:"bg-white p-2 flex rounded-lg",children:(0,x.jsx)(a.Ay,{className:"",children:(0,x.jsx)(r.wT,{})})}),(0,x.jsxs)(a.Ay,{className:"grid mt-2 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-4 gap-2",children:[(0,x.jsxs)(_,{children:[(0,x.jsx)(F,{children:M("dashboard.total_orders")}),(0,x.jsx)(d.A,{style:{fontSize:"24px",fontWeight:600,textAlign:"center",color:"#FF6701"},children:null===Z||void 0===Z||null===(t=Z.data)||void 0===t?void 0:t.total_amount})]}),null===Z||void 0===Z||null===(e=Z.data)||void 0===e?void 0:e.states.map(t=>{var e;return(0,x.jsxs)(_,{children:[(0,x.jsx)(F,{children:"completed"===(null===(e=t.state)||void 0===e?void 0:e.state)?M("dashboard.completed_orders"):M("dashboard.cancelled_orders")}),(0,x.jsx)(d.A,{style:{fontSize:"24px",fontWeight:600,textAlign:"center",color:"#FF6701"},children:t.total_amount})]})}),(0,x.jsxs)(_,{children:[(0,x.jsx)(F,{children:M("dashboard.total_income")}),(0,x.jsxs)(d.A,{style:{fontSize:"18px",fontWeight:600,textAlign:"center",color:"#FF6701"},children:[(0,c.j)(null===R||void 0===R||null===(o=R.data)||void 0===o?void 0:o.income)," ",(0,v.get)(I,"currency","uzs")]})]}),(0,x.jsxs)(_,{children:[(0,x.jsx)(F,{children:M("dashboard.registered_customer")}),(0,x.jsx)(d.A,{style:{fontSize:"24px",fontWeight:600,textAlign:"center",color:"#FF6701"},children:null===U||void 0===U||null===(u=U.data)||void 0===u?void 0:u.registered})]}),(0,x.jsxs)(_,{children:[(0,x.jsx)(F,{children:M("dashboard.active_customer")}),(0,x.jsx)(d.A,{style:{fontSize:"24px",fontWeight:600,textAlign:"center",color:"#FF6701"},children:null===U||void 0===U||null===(m=U.data)||void 0===m?void 0:m.active})]}),(0,x.jsxs)(_,{children:[(0,x.jsx)(F,{children:M("dashboard.sold_product")}),(0,x.jsx)(d.A,{style:{fontSize:"24px",fontWeight:600,textAlign:"center",color:"#FF6701"},children:null===Z||void 0===Z||null===(h=Z.data)||void 0===h?void 0:h.productCount})]}),(0,x.jsxs)(_,{children:[(0,x.jsx)(F,{children:M("dashboard.customers_saved_time")}),(0,x.jsx)(d.A,{style:{fontSize:"20px",fontWeight:600,textAlign:"center",color:"#FF6701"},children:(0,S.d)(null===$||void 0===$||null===(f=$.data)||void 0===f?void 0:f.saved_time)})]}),(0,x.jsxs)(_,{children:[(0,x.jsx)(F,{children:M("dashboard.customers_saved_amount")}),(0,x.jsxs)(d.A,{style:{fontSize:"18px",fontWeight:600,textAlign:"center",color:"#FF6701"},children:[(0,c.j)(null===$||void 0===$||null===(j=$.data)||void 0===j?void 0:j.saved_amount)," ",(0,v.get)(I,"currency","uzs")]})]}),(0,x.jsxs)(_,{children:[(0,x.jsx)(F,{children:M("general.all_discounts_summ")}),(0,x.jsxs)(d.A,{style:{fontSize:"18px",fontWeight:600,textAlign:"center",color:"#FF6701"},children:[(0,c.j)(null===Z||void 0===Z||null===(y=Z.data)||void 0===y?void 0:y.total_discount)," ",(0,v.get)(I,"currency","uzs")]})]}),(0,x.jsxs)(_,{children:[(0,x.jsx)(F,{children:M("general.all_promocode_summ")}),(0,x.jsxs)(d.A,{style:{fontSize:"18px",fontWeight:600,textAlign:"center",color:"#FF6701"},children:[(0,c.j)(null===Z||void 0===Z||null===(N=Z.data)||void 0===N?void 0:N.total_promocode)," ",(0,v.get)(I,"currency","uzs")]})]})]}),(0,x.jsx)(a.Ay,{className:"p-2 bg-white mt-2 rounded-lg",children:(0,x.jsx)(b,{data:null===Z||void 0===Z||null===(A=Z.data)||void 0===A?void 0:A.states,all_orders:null===Z||void 0===Z||null===(w=Z.data)||void 0===w?void 0:w.total_amount})}),(0,x.jsxs)(a.Ay,{className:"bg-white mt-2 rounded-lg p-4",children:[(0,x.jsx)(d.A,{style:{fontSize:"20px",fontWeight:600,marginBottom:"16px",color:"#FF6701"},children:M("dashboard.orders_by_location")}),(0,x.jsx)(L,{height:"600px",useDemoData:!0})]}),(0,x.jsxs)(a.Ay,{className:"grid mt-2 md:grid-cols-2 gap-4",children:[(0,x.jsxs)("div",{className:"bg-white rounded-lg",children:[(0,x.jsx)("p",{className:"font-semibold text-lg p-3",children:M("dashboard.top_users")}),(0,x.jsx)(g,{data:null===P||void 0===P?void 0:P.data,setSortField:O,sortField:k,setSortOrder:T,sortOrder:C})]}),(0,x.jsxs)("div",{className:"bg-white rounded-lg",children:[(0,x.jsx)("p",{className:"font-semibold text-lg p-3",children:M("dashboard.top_courier")}),(0,x.jsx)(g,{data:null===J||void 0===J?void 0:J.data,setSortField:q,sortField:W,setSortOrder:E,sortOrder:B})]})]})]})},k=()=>(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(z,{})})},72824:(t,e,o)=>{o.d(e,{j:()=>a});const a=t=>{if(t||0===t){return(Math.round(100*(t+Number.EPSILON))/100).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).replaceAll(","," ")}return""}},90116:(t,e,o)=>{o.d(e,{d:()=>a});const a=t=>{if(!t||t<=0)return"0 daqiqa";const e=Math.round(t),o=Math.floor(e/60),a=e%60;return o>0?"".concat(o," soat ").concat(a," daqiqa"):"".concat(a," daqiqa")}}}]);
//# sourceMappingURL=504.0d8f3919.chunk.js.map